<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lawn Master Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- DATABASE & CONFIG ---
        const ZONES = ['Front Yard', 'Back Yard', 'Side Yard'];
        
        const PRODUCT_DATABASE = {
            mowers: [{ id: 'm1', name: 'Honda HRX217VKA' }, { id: 'm2', name: 'Toro Recycler 22"' }],
            fertilizers: [{ id: 'f1', name: 'Scotts Turf Builder', npk: '32-0-4' }, { id: 'f2', name: 'Milorganite Organic', npk: '6-4-0' }],
            spreaders: [{ id: 'sp1', name: 'Echo RB-60' }, { id: 'sp2', name: 'Scotts Elite' }],
            seeds: [{ id: 's1', name: 'Scotts Sun & Shade' }],
            herbicides: [{ id: 'h1', name: 'Ortho Weed B Gon' }, { id: 'h4', name: 'Scotts Halts Pre-Emergent' }],
            pesticides: [{ id: 'p1', name: 'Spectracide Triazicide' }]
        };

        const ACTIVITY_TYPES = {
            mowing: { name: 'Mowing', icon: 'üöú', color: 'bg-green-500' },
            fertilizer: { name: 'Fertilizer', icon: 'üå±', color: 'bg-amber-500' },
            watering: { name: 'Watering', icon: 'üíß', color: 'bg-blue-500' },
            treatment: { name: 'Treatment', icon: 'üõ°Ô∏è', color: 'bg-red-500' }
        };

        function App() {
            const [activities, setActivities] = useState([]);
            const [view, setView] = useState('home'); 
            const [selectedType, setSelectedType] = useState(null);
            const [formData, setFormData] = useState({ zone: 'Front Yard' });
            
            // Mock Weather (Replace with API data in production)
            const weather = { temp: 72, soilTemp: 52, rainfall: 0.2 };

            useEffect(() => {
                const saved = localStorage.getItem('lawnCareData');
                if (saved) setActivities(JSON.parse(saved));
            }, []);

            // --- FEATURE #3: INTELLIGENT FORECAST ---
            const recommendations = useMemo(() => {
                const recs = [];
                const lastMow = activities.find(a => a.type === 'mowing');
                const daysSinceMow = lastMow ? Math.floor((Date.now() - lastMow.id) / 86400000) : 10;

                if (daysSinceMow > 5) {
                    recs.push({ title: 'Time to Mow', text: `It's been ${daysSinceMow} days since your last trim.`, icon: 'üöú', color: 'border-green-500' });
                }
                
                // SOIL TEMP ALERT LOGIC
                if (weather.soilTemp >= 50 && weather.soilTemp <= 55) {
                    recs.push({ title: 'Pre-Emergent Window', text: 'CRITICAL: Soil is 50-55¬∞F. Apply crabgrass preventer now!', icon: 'üõ°Ô∏è', color: 'border-red-500' });
                }

                if (weather.rainfall < 0.5 && weather.temp > 80) {
                    recs.push({ title: 'Watering Recommended', text: 'High heat and low rain detected. Deep soak today.', icon: 'üíß', color: 'border-blue-500' });
                }

                return recs;
            }, [activities, weather]);

            // SOIL TEMP COLOR HELPER
            const getSoilTempColor = (temp) => {
                if (temp < 50) return 'text-blue-500'; // Too cold
                if (temp >= 50 && temp <= 55) return 'text-green-600 font-black animate-pulse'; // THE WINDOW
                return 'text-amber-600'; // Growing season
            };

            const saveActivity = () => {
                const newAct = { id: Date.now(), type: selectedType, ...formData, date: new Date().toLocaleDateString() };
                const updated = [newAct, ...activities];
                setActivities(updated);
                localStorage.setItem('lawnCareData', JSON.stringify(updated));
                setView('history');
                setSelectedType(null);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white pb-24 shadow-2xl">
                    {/* Header */}
                    <header className="bg-green-700 text-white p-6 rounded-b-[2.5rem] shadow-lg">
                        <div className="flex justify-between items-start">
                            <div>
                                <h1 className="text-2xl font-bold">Lawn Master</h1>
                                <p className="text-xs opacity-80 uppercase tracking-widest font-bold">Maintenance Dashboard</p>
                            </div>
                            <div className="text-right">
                                <div className="text-xs opacity-70">SOIL TEMP</div>
                                <div className={`text-2xl font-bold ${getSoilTempColor(weather.soilTemp)}`}>
                                    {weather.soilTemp}¬∞F
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="p-5">
                        {/* SMART FORECAST SECTION */}
                        {view === 'home' && (
                            <div className="space-y-4">
                                <h2 className="text-xs font-black text-gray-400 uppercase tracking-widest">Recommended Actions</h2>
                                {recommendations.length > 0 ? recommendations.map((rec, i) => (
                                    <div key={i} className={`bg-white border-l-4 p-4 rounded-xl shadow-sm flex items-center gap-4 ${rec.color}`}>
                                        <span className="text-2xl">{rec.icon}</span>
                                        <div>
                                            <h3 className="font-bold text-gray-800 leading-tight">{rec.title}</h3>
                                            <p className="text-xs text-gray-500">{rec.text}</p>
                                        </div>
                                    </div>
                                )) : <p className="text-center text-gray-400 py-10">Lawn is looking great! No urgent tasks.</p>}
                            </div>
                        )}

                        {/* ADD ACTIVITY VIEW WITH ZONE SELECTOR */}
                        {view === 'add' && !selectedType && (
                            <div className="grid grid-cols-2 gap-4">
                                {Object.entries(ACTIVITY_TYPES).map(([key, cfg]) => (
                                    <button key={key} onClick={() => setSelectedType(key)} className="bg-gray-50 p-6 rounded-3xl border border-gray-100 flex flex-col items-center hover:bg-white hover:shadow-md transition">
                                        <span className="text-3xl mb-2">{cfg.icon}</span>
                                        <span className="font-bold text-gray-700">{cfg.name}</span>
                                    </button>
                                ))}
                            </div>
                        )}

                        {view === 'add' && selectedType && (
                            <div className="bg-white p-2 space-y-6">
                                <h2 className="text-xl font-bold flex items-center gap-2">
                                    {ACTIVITY_TYPES[selectedType].icon} Log {ACTIVITY_TYPES[selectedType].name}
                                </h2>
                                
                                {/* ZONE SELECTOR (#2) */}
                                <div>
                                    <label className="block text-xs font-black text-gray-400 uppercase mb-3">Which Zone?</label>
                                    <div className="grid grid-cols-3 gap-2">
                                        {ZONES.map(z => (
                                            <button 
                                                key={z} 
                                                onClick={() => setFormData({...formData, zone: z})}
                                                className={`py-3 rounded-xl text-xs font-bold transition border ${formData.zone === z ? 'bg-green-600 text-white border-green-600 shadow-md' : 'bg-gray-50 text-gray-500 border-gray-100'}`}
                                            >
                                                {z.split(' ')[0]}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={saveActivity} className="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-lg text-lg">Save Activity</button>
                                <button onClick={() => setSelectedType(null)} className="w-full text-gray-400 text-sm font-medium">Change Activity Type</button>
                            </div>
                        )}

                        {/* HISTORY VIEW */}
                        {view === 'history' && (
                            <div className="space-y-3">
                                <h2 className="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">Activity Log</h2>
                                {activities.map(a => (
                                    <div key={a.id} className="bg-white p-4 rounded-2xl shadow-sm border border-gray-50 flex justify-between items-center">
                                        <div className="flex items-center gap-4">
                                            <div className={`${ACTIVITY_TYPES[a.type].color} w-10 h-10 rounded-full flex items-center justify-center text-white`}>
                                                {ACTIVITY_TYPES[a.type].icon}
                                            </div>
                                            <div>
                                                <div className="font-bold text-gray-800">{ACTIVITY_TYPES[a.type].name}</div>
                                                <div className="text-[10px] font-black text-green-600 uppercase tracking-tighter">{a.zone}</div>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-xs text-gray-400 font-medium">{a.date}</div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {/* Navigation */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-sm bg-white/80 backdrop-blur-md border border-gray-100 p-3 rounded-[2rem] flex justify-around items-center shadow-2xl">
                        <button onClick={() => setView('home')} className={`flex flex-col items-center ${view === 'home' ? 'text-green-600' : 'text-gray-400'}`}>
                            <span className="text-xl">üè†</span>
                            <span className="text-[10px] font-bold uppercase mt-1">Home</span>
                        </button>
                        <button onClick={() => { setView('add'); setSelectedType(null); }} className="bg-green-600 w-14 h-14 rounded-full shadow-lg -mt-12 border-4 border-white flex items-center justify-center text-white text-3xl font-bold">
                            +
                        </button>
                        <button onClick={() => setView('history')} className={`flex flex-col items-center ${view === 'history' ? 'text-green-600' : 'text-gray-400'}`}>
                            <span className="text-xl">üìã</span>
                            <span className="text-[10px] font-bold uppercase mt-1">Logs</span>
                        </button>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
