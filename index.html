<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Version 5.0 - Updated: Feb 8, 2026 - Research-Based Recommendations with Citation System -->
    <meta name="color-scheme" content="light">
    <meta name="theme-color" content="#367C2B">
    <meta name="description" content="Your lawn care made simple - track, plan, and achieve the perfect green lawn">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Lawn Coach">
    <title>Lawn Coach - DIY Lawn Care Tracking</title>

```
<!-- PWA Manifest -->
<link rel="manifest" href="/manifest.json">

<!-- Icons -->
<link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
<link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
<link rel="apple-touch-icon" href="/icon-192.png">

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide-static/0.263.1/lucide.min.css">

<!-- Register Service Worker -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registered:', registration);
                })
                .catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
        });
    }
</script>
```

</head>
<body class="bg-white" style="background-color: #ffffff !important;">
    <!-- Hide any loading artifacts -->
    <style>
        body::before,
        body > *:not(#root):not(script) {
            display: none !important;
        }
        #root {
            min-height: 100vh;
        }
    </style>
    <div id="root"></div>

```
<script type="text/babel">
    const { useState, useEffect } = React;
    
    // Comprehensive Product Database - Top lawn care products from major retailers
    const PRODUCT_DATABASE = {
        mowers: [
            { id: 'm-other', name: 'Other (Specify)', brand: 'Other', type: 'Custom', deck: '', features: '', maintenanceSchedule: { oilChange: null, note: 'Custom mower - set your own maintenance schedule' } },
            { id: 'm6', name: 'Craftsman M215', brand: 'Craftsman', type: 'Gas Push', deck: '21"', features: 'Briggs & Stratton, Side Discharge', maintenanceSchedule: { oilChange: 50, airFilter: 'yearly', sparkPlug: 100 } },
            { id: 'm3', name: 'EGO Power+ LM2142SP', brand: 'EGO', type: 'Battery Self-Propelled', deck: '21"', features: '56V, LED Headlights', maintenanceSchedule: { oilChange: null, note: 'Battery-powered - no oil changes needed' } },
            { id: 'm4', name: 'Greenworks 25223', brand: 'Greenworks', type: 'Corded Electric', deck: '20"', features: '12 Amp, 3-in-1', maintenanceSchedule: { oilChange: null, note: 'Electric - no oil changes needed' } },
            { id: 'm1', name: 'Honda HRX217VKA', brand: 'Honda', type: 'Gas Self-Propelled', deck: '21"', features: 'Variable Speed, Versamow', maintenanceSchedule: { oilChange: 50, airFilter: 50, sparkPlug: 100, note: 'Every 25 hours under heavy load' } },
            { id: 'm5', name: 'Husqvarna LC221RH', brand: 'Husqvarna', type: 'Gas Self-Propelled', deck: '21"', features: 'Honda Engine, High Wheels', maintenanceSchedule: { oilChange: 50, airFilter: 50, sparkPlug: 100 } },
            { id: 'm8', name: 'John Deere JS46', brand: 'John Deere', type: 'Gas Self-Propelled', deck: '22"', features: 'Rear Wheel Drive, 190cc', maintenanceSchedule: { oilChange: 50, airFilter: 50, sparkPlug: 100 } },
            { id: 'm9', name: 'Makita XML08Z', brand: 'Makita', type: 'Battery Self-Propelled', deck: '21"', features: '36V x4, Commercial Grade', maintenanceSchedule: { oilChange: null, note: 'Battery-powered - no oil changes needed' } },
            { id: 'm7', name: 'Ryobi 40V RY40190', brand: 'Ryobi', type: 'Battery Push', deck: '20"', features: '40V Lithium, Brushless', maintenanceSchedule: { oilChange: null, note: 'Battery-powered - no oil changes needed' } },
            { id: 'm2', name: 'Toro Recycler 22"', brand: 'Toro', type: 'Gas Self-Propelled', deck: '22"', features: 'Personal Pace, SmartStow', maintenanceSchedule: { oilChange: 50, airFilter: 'yearly', sparkPlug: 'yearly' } },
            { id: 'm11', name: 'Toro TimeMaster 30"', brand: 'Toro', type: 'Gas Self-Propelled', deck: '30"', features: 'Dual-Force Cutting, Personal Pace', maintenanceSchedule: { oilChange: 50, airFilter: 'yearly', sparkPlug: 'yearly', bladeService: 'yearly' } },
            { id: 'm10', name: 'Troy-Bilt TB330', brand: 'Troy-Bilt', type: 'Gas Self-Propelled', deck: '21"', features: 'TriAction Cutting, 163cc', maintenanceSchedule: { oilChange: 50, airFilter: 'yearly', sparkPlug: 100 } }
        ],
        spreaders: [
            { id: 'sp1', name: 'Echo RB-60 Spreader', brand: 'Echo', type: 'Broadcast', capacity: '60 lbs', features: 'Edge Guard, Pneumatic Tires', maintenanceSchedule: { cleaning: 'after each use', tires: 'check pressure 15 psi', note: 'Maintenance-free gear case' } },
            { id: 'sp2', name: 'Scotts Elite Spreader', brand: 'Scotts', type: 'Broadcast', capacity: '20000 sq ft', features: 'EdgeGuard, Never Flat Tires', maintenanceSchedule: { cleaning: 'after each use', note: 'No lubrication required' } },
            { id: 'sp3', name: 'Earthway 2150', brand: 'Earthway', type: 'Broadcast', capacity: '50 lbs', features: 'Commercial Grade, EV-N-Spred', maintenanceSchedule: { cleaning: 'after each use', lubrication: 'seasonal' } },
            { id: 'sp4', name: 'Agri-Fab 45-0463', brand: 'Agri-Fab', type: 'Tow-Behind', capacity: '130 lbs', features: 'Universal Hitch, Pneumatic Tires', maintenanceSchedule: { cleaning: 'after each use', lubrication: 'seasonal', tires: 'check pressure' } },
            { id: 'sp5', name: 'Chapin 8706A', brand: 'Chapin', type: 'Broadcast', capacity: '80 lbs', features: 'Auto-Stop, Baffle System', maintenanceSchedule: { cleaning: 'after each use', lubrication: 'before each season' } },
            { id: 'sp6', name: 'Scotts Wizz Hand-Held', brand: 'Scotts', type: 'Hand-Held', capacity: '2500 sq ft', features: 'Battery Powered, EdgeGuard', maintenanceSchedule: { cleaning: 'after each use', battery: 'charge as needed' } },
            { id: 'sp7', name: 'Lesco High Wheel', brand: 'Lesco', type: 'Broadcast', capacity: '80 lbs', features: 'Stainless Steel, Pro-Grade', maintenanceSchedule: { cleaning: 'after each use', lubrication: 'monthly during season' } },
            { id: 'sp8', name: 'Spyker P70-12010', brand: 'Spyker', type: 'Broadcast', capacity: '70 lbs', features: 'Enclosed Gears, Pro Series', maintenanceSchedule: { cleaning: 'after each use', gearbox: 'check oil annually' } },
            { id: 'sp9', name: 'Brinly BS36BH', brand: 'Brinly', type: 'Tow-Behind', capacity: '175 lbs', features: 'Pneumatic Tires, Heavy Duty', maintenanceSchedule: { cleaning: 'after each use', lubrication: 'seasonal', tires: 'check pressure' } },
            { id: 'sp10', name: 'Scotts Turf Builder EdgeGuard Mini', brand: 'Scotts', type: 'Broadcast', capacity: '5000 sq ft', features: 'Compact, EdgeGuard', maintenanceSchedule: { cleaning: 'after each use', note: 'Minimal maintenance' } }
        ],
        trimmers: [
            { id: 't-other', name: 'Other (Specify)', brand: 'Other', type: 'Custom', engineType: '', lineSize: '' },
            { id: 't1', name: 'Echo SRM-225', brand: 'Echo', type: 'Gas', engineType: 'Gas', lineSize: '.095"', features: '21.2cc, 2-Stroke' },
            { id: 't2', name: 'Stihl FS 56 RC-E', brand: 'Stihl', type: 'Gas', engineType: 'Gas', lineSize: '.105"', features: '27.2cc, Easy2Start' },
            { id: 't3', name: 'Husqvarna 128LD', brand: 'Husqvarna', type: 'Gas', engineType: 'Gas', lineSize: '.095"', features: '28cc, Detachable' },
            { id: 't4', name: 'EGO Power+ ST1521S', brand: 'EGO', type: 'Battery', engineType: 'Electric', lineSize: '.095"', features: '56V, Powerload' },
            { id: 't5', name: 'Makita XRU15Z', brand: 'Makita', type: 'Battery', engineType: 'Electric', lineSize: '.095"', features: '18V LXT' },
            { id: 't6', name: 'DeWalt DCST972X1', brand: 'DeWalt', type: 'Battery', engineType: 'Electric', lineSize: '.080"', features: '60V Max Flex' },
            { id: 't7', name: 'Ryobi RY40250', brand: 'Ryobi', type: 'Battery', engineType: 'Electric', lineSize: '.080"', features: '40V Brushless' },
            { id: 't8', name: 'Black+Decker LST136', brand: 'Black+Decker', type: 'Battery', engineType: 'Electric', lineSize: '.065"', features: '40V, Auto-Feed' },
            { id: 't9', name: 'Milwaukee 2825-21ST', brand: 'Milwaukee', type: 'Battery', engineType: 'Electric', lineSize: '.080"', features: 'M18 Fuel Quik-Lok' },
            { id: 't10', name: 'Craftsman CMXGTAMD25CC', brand: 'Craftsman', type: 'Gas', engineType: 'Gas', lineSize: '.095"', features: '25cc, 2-Cycle' }
        ],
        fertilizers: [
            { id: 'f1', name: 'Scotts Turf Builder Lawn Food', brand: 'Scotts', npk: '32-0-4', coverage: '15000 sq ft', type: 'Slow-Release Nitrogen' },
            { id: 'f2', name: 'Milorganite Organic Fertilizer', brand: 'Milorganite', npk: '6-4-0', coverage: '2500 sq ft', type: 'Organic, Slow-Release' },
            { id: 'f3', name: 'Jonathan Green Green-Up', brand: 'Jonathan Green', npk: '29-0-3', coverage: '15000 sq ft', type: 'Professional Grade' },
            { id: 'f4', name: 'Pennington UltraGreen', brand: 'Pennington', npk: '30-0-4', coverage: '12500 sq ft', type: 'Nitrogen Stabilized' },
            { id: 'f5', name: 'GreenView Fairway Formula', brand: 'GreenView', npk: '22-0-4', coverage: '15000 sq ft', type: 'Spring Booster' },
            { id: 'f6', name: 'Lesco Professional 24-0-11', brand: 'Lesco', npk: '24-0-11', coverage: '12500 sq ft', type: 'Balanced Formula' },
            { id: 'f7', name: 'Scotts Turf Builder EdgeGuard', brand: 'Scotts', npk: '38-0-6', coverage: '10000 sq ft', type: 'High Nitrogen' },
            { id: 'f8', name: 'Safer Brand Lawn Restore', brand: 'Safer Brand', npk: '9-0-2', coverage: '5000 sq ft', type: 'Organic, Pet-Safe' },
            { id: 'f9', name: 'Purely Organic Lawn Food', brand: 'Purely Organic', npk: '10-0-2', coverage: '2000 sq ft', type: 'OMRI Certified' },
            { id: 'f10', name: 'Sunday Smart Lawn Care', brand: 'Sunday', npk: '11-0-0', coverage: '5000 sq ft', type: 'Custom Blend, Organic' }
        ],
        seeds: [
            { id: 's1', name: 'Scotts Turf Builder Grass Seed', brand: 'Scotts', type: 'Sun & Shade Mix', coverage: '2800 sq ft', variety: 'Tall Fescue Blend' },
            { id: 's2', name: 'Pennington Smart Seed', brand: 'Pennington', type: 'Dense Shade', coverage: '1200 sq ft', variety: 'Fine Fescue Mix' },
            { id: 's3', name: 'Jonathan Green Black Beauty', brand: 'Jonathan Green', type: 'Ultra Mix', coverage: '5600 sq ft', variety: 'Tall Fescue' },
            { id: 's4', name: 'GCI Turf Type Tall Fescue', brand: 'GCI', type: 'Premium TTTF', coverage: '10000 sq ft', variety: 'Certified Seed' },
            { id: 's5', name: 'Kentucky 31 Tall Fescue', brand: 'Pennington', type: 'K-31', coverage: '5000 sq ft', variety: 'Cool Season' },
            { id: 's6', name: 'Perennial Ryegrass Seed', brand: 'Barenbrug', type: 'RPR Technology', coverage: '5000 sq ft', variety: 'Quick Germination' },
            { id: 's7', name: 'Scotts EZ Seed Patch & Repair', brand: 'Scotts', type: 'Mulch Mix', coverage: '225 sq ft', variety: 'All-in-One' },
            { id: 's8', name: 'Zoysia Grass Seed', brand: 'Zenith', type: 'Warm Season', coverage: '2000 sq ft', variety: 'Drought Tolerant' },
            { id: 's9', name: 'Bermuda Grass Seed', brand: 'Outsidepride', type: 'Improved', coverage: '3000 sq ft', variety: 'Southern Lawns' },
            { id: 's10', name: 'Kentucky Bluegrass Mix', brand: 'Jonathan Green', type: 'Premium KBG', coverage: '3000 sq ft', variety: 'Fine Texture' }
        ],
        herbicides: [
            { id: 'h1', name: 'Ortho Weed B Gon', brand: 'Ortho', type: 'Post-Emergent', target: 'Broadleaf Weeds', coverage: '16000 sq ft' },
            { id: 'h2', name: 'Spectracide Weed Stop', brand: 'Spectracide', type: 'Post-Emergent', target: 'Dandelions, Clover', coverage: '5000 sq ft' },
            { id: 'h3', name: 'Preen Lawn Weed Control', brand: 'Preen', type: 'Pre-Emergent', target: 'Crabgrass', coverage: '5000 sq ft' },
            { id: 'h4', name: 'Scotts Halts Crabgrass Preventer', brand: 'Scotts', type: 'Pre-Emergent', target: 'Crabgrass, Grassy Weeds', coverage: '15000 sq ft' },
            { id: 'h5', name: 'BioAdvanced All-in-One', brand: 'BioAdvanced', type: 'Weed & Feed', target: 'Weeds + Fertilizer', coverage: '10000 sq ft' },
            { id: 'h6', name: 'Tenacity Herbicide', brand: 'SePRO', type: 'Pre/Post-Emergent', target: 'Crabgrass, Clover', coverage: '10000 sq ft' },
            { id: 'h7', name: 'Compare-N-Save Concentrate', brand: 'Compare-N-Save', type: 'Non-Selective', target: 'All Vegetation', coverage: '25000 sq ft' },
            { id: 'h8', name: 'Natural Armor Weed Killer', brand: 'Natural Armor', type: 'Organic', target: 'Broadleaf Weeds', coverage: '1000 sq ft' },
            { id: 'h9', name: 'Prodiamine 65 WDG', brand: 'Generic', type: 'Pre-Emergent', target: 'Annual Grasses', coverage: '43560 sq ft' },
            { id: 'h10', name: 'Celsius WG Herbicide', brand: 'Bayer', type: 'Post-Emergent', target: 'Warm Season Weeds', coverage: '43560 sq ft' }
        ],
        pesticides: [
            { id: 'p1', name: 'Spectracide Triazicide', brand: 'Spectracide', type: 'Insect Killer', target: 'Grubs, Ants, Fleas', coverage: '10000 sq ft' },
            { id: 'p2', name: 'BioAdvanced Grub Killer', brand: 'BioAdvanced', type: 'Season-Long Control', target: 'Grubs, Japanese Beetles', coverage: '10000 sq ft' },
            { id: 'p3', name: 'Scotts GrubEx', brand: 'Scotts', type: 'Preventive Grub Control', target: 'Grub Prevention', coverage: '10000 sq ft' },
            { id: 'p4', name: 'Sevin Insect Killer', brand: 'Sevin', type: 'Contact Killer', target: 'Over 500 Insects', coverage: '5000 sq ft' },
            { id: 'p5', name: 'Dylox 6.2 Granular', brand: 'Bayer', type: 'Fast-Acting', target: 'Active Grubs', coverage: '7000 sq ft' },
            { id: 'p6', name: 'Milky Spore Powder', brand: 'St. Gabriel', type: 'Organic', target: 'Japanese Beetle Grubs', coverage: '2500 sq ft' },
            { id: 'p7', name: 'Ortho BugClear Lawn', brand: 'Ortho', type: 'Surface & Soil', target: 'Ants, Ticks, Chinch Bugs', coverage: '10000 sq ft' },
            { id: 'p8', name: 'Scotts DiseaseEx', brand: 'Scotts', type: 'Fungicide', target: 'Brown Patch, Dollar Spot', coverage: '5000 sq ft' },
            { id: 'p9', name: 'Eagle 20EW Fungicide', brand: 'Dow', type: 'Systemic', target: 'Lawn Diseases', coverage: '43560 sq ft' },
            { id: 'p10', name: 'Neem Oil Concentrate', brand: 'Bonide', type: 'Organic', target: 'Insects & Diseases', coverage: 'Varies' }
        ]
    };
    
    // Treatment Products Database - Organized by Category
    const TREATMENT_PRODUCTS = {
        fertilizer: [
            // Keep existing fertilizer products - will be populated from fertilizers array above
        ],
        preemergent: [
            { id: 'pre1', name: 'Prodiamine 65 WDG (Yard Mastery)', brand: 'Yard Mastery', activeIngredient: 'Prodiamine 65%', rate: '0.5 oz per 1,000 sq ft', timing: 'When soil hits 50-55Â°F', notes: 'Premium WDG formulation' },
            { id: 'pre2', name: 'Barricade 4FL', brand: 'Syngenta', activeIngredient: 'Prodiamine 41.7%', rate: '0.5 fl oz per 1,000 sq ft', timing: 'Early spring & fall', notes: 'Liquid concentrate' },
            { id: 'pre3', name: 'Dimension 2EW', brand: 'Dow', activeIngredient: 'Dithiopyr 23.3%', rate: '0.5 fl oz per 1,000 sq ft', timing: 'Pre & early post-emergent', notes: 'Works on young crabgrass' },
            { id: 'pre4', name: 'Scotts Halts', brand: 'Scotts', activeIngredient: 'Pendimethalin', rate: '2.9 lbs per 1,000 sq ft', timing: 'Early spring', notes: 'Granular, easy application' },
            { id: 'pre5', name: 'Other (specify)', brand: 'Various', activeIngredient: '', rate: 'See label', timing: '', notes: 'Custom product' }
        ],
        postemergent: [
            { id: 'post1', name: 'Tenacity', brand: 'Syngenta', activeIngredient: 'Mesotrione 40%', rate: '0.25 oz per 1,000 sq ft', target: 'Crabgrass, broadleaf weeds', notes: 'Safe for seeding' },
            { id: 'post2', name: 'Ortho Weed B Gon', brand: 'Ortho', activeIngredient: '2,4-D + Quinclorac', rate: 'Per label', target: 'Broadleaf & grassy weeds', notes: 'Ready-to-spray' },
            { id: 'post3', name: 'Speedzone', brand: 'PBI Gordon', activeIngredient: '2,4-D + others', rate: '1.5 fl oz per 1,000 sq ft', target: 'Fast-acting broadleaf', notes: 'Works in cool temps' },
            { id: 'post4', name: 'Quinclorac 75DF', brand: 'Various', activeIngredient: 'Quinclorac 75%', rate: '0.25 oz per 1,000 sq ft', target: 'Crabgrass, clover', notes: 'Selective herbicide' },
            { id: 'post5', name: 'Other (specify)', brand: 'Various', activeIngredient: '', rate: 'See label', target: '', notes: 'Custom product' }
        ],
        fungicide: [
            { id: 'fung1', name: 'Disease Ex (Scotts)', brand: 'Scotts', activeIngredient: 'Azoxystrobin 0.31%', rate: '3 lbs per 1,000 sq ft', target: 'Brown patch, dollar spot', notes: 'Granular, preventative' },
            { id: 'fung2', name: 'Azoxystrobin 0.31G', brand: 'Various', activeIngredient: 'Azoxystrobin 0.31%', rate: '3 lbs per 1,000 sq ft', target: 'Broad spectrum', notes: 'Generic Disease Ex' },
            { id: 'fung3', name: 'Propiconazole 14.3', brand: 'Various', activeIngredient: 'Propiconazole 14.3%', rate: '1 fl oz per 1,000 sq ft', target: 'Systemic fungicide', notes: 'Liquid concentrate' },
            { id: 'fung4', name: 'Heritage G', brand: 'Syngenta', activeIngredient: 'Azoxystrobin 0.5%', rate: '2 lbs per 1,000 sq ft', target: 'Premium fungicide', notes: 'Professional grade' },
            { id: 'fung5', name: 'Other (specify)', brand: 'Various', activeIngredient: '', rate: 'See label', target: '', notes: 'Custom product' }
        ],
        insecticide: [
            { id: 'ins1', name: 'GrubEx (Scotts)', brand: 'Scotts', activeIngredient: 'Chlorantraniliprole', rate: '2.87 lbs per 1,000 sq ft', target: 'Grubs (preventative)', notes: 'Apply late spring/early summer' },
            { id: 'ins2', name: 'BioAdvanced Grub Killer', brand: 'BioAdvanced', activeIngredient: 'Imidacloprid', rate: '3 lbs per 1,000 sq ft', target: 'Grubs, mole crickets', notes: 'Season-long control' },
            { id: 'ins3', name: 'Dylox 6.2G', brand: 'Bayer', activeIngredient: 'Trichlorfon 6.2%', rate: '3 lbs per 1,000 sq ft', target: 'Active grubs', notes: '24-hour curative' },
            { id: 'ins4', name: 'Bifenthrin 0.2G', brand: 'Various', activeIngredient: 'Bifenthrin 0.2%', rate: '2.3 lbs per 1,000 sq ft', target: 'Surface insects', notes: 'Ants, chinch bugs' },
            { id: 'ins5', name: 'Other (specify)', brand: 'Various', activeIngredient: '', rate: 'See label', target: '', notes: 'Custom product' }
        ],
        soilAmendment: [
            { id: 'soil1', name: 'Pelletized Lime', brand: 'Various', type: 'pH Increase', rate: '50 lbs per 1,000 sq ft', effect: 'Raises pH by ~0.5', notes: 'For acidic soils (pH <6.5)' },
            { id: 'soil2', name: 'Elemental Sulfur', brand: 'Various', type: 'pH Decrease', rate: '5-10 lbs per 1,000 sq ft', effect: 'Lowers pH by ~0.5', notes: 'For alkaline soils (pH >7.0)' },
            { id: 'soil3', name: 'Gypsum', brand: 'Various', type: 'Soil Structure', rate: '40 lbs per 1,000 sq ft', effect: 'Improves clay soil', notes: 'Does not change pH' },
            { id: 'soil4', name: 'Humic Acid', brand: 'Various', type: 'Soil Health', rate: '3 fl oz per 1,000 sq ft', effect: 'Improves nutrient uptake', notes: 'Liquid application' },
            { id: 'soil5', name: 'Other (specify)', brand: 'Various', type: '', rate: 'See label', effect: '', notes: 'Custom product' }
        ]
    };
    
    // Treatment category definitions
    const TREATMENT_CATEGORIES = {
        fertilizer: { label: 'Fertilizer', icon: 'ðŸŒ¾', description: 'NPK nutrients for growth' },
        preemergent: { label: 'Pre-Emergent', icon: 'ðŸ›¡ï¸', description: 'Prevent weed seeds from germinating' },
        postemergent: { label: 'Post-Emergent', icon: 'ðŸŒ¿', description: 'Kill existing weeds' },
        fungicide: { label: 'Fungicide', icon: 'ðŸ„', description: 'Prevent or treat lawn diseases' },
        insecticide: { label: 'Insecticide', icon: 'ðŸ›', description: 'Control grubs and insects' },
        soilAmendment: { label: 'Soil Amendment', icon: 'ðŸŒ', description: 'Adjust pH or improve soil' }
    };
    
    // Activity type definitions with their custom fields
    const ACTIVITY_TYPES = {
        mowing: {
            name: 'Mowing Lawn',
            icon: 'activity-mowing.png',
            color: 'bg-[#367C2B]',
            fields: [
                { 
                    name: 'mowerUsed', 
                    label: 'Mower Model', 
                    type: 'product-select', 
                    productType: 'mowers',
                    placeholder: 'Select your mower...'
                },
                { name: 'mowHeight', label: 'Mow Height', type: 'select', options: ['1.5"', '2"', '2.5"', '3"', '3.5"', '4"', '4.5"'] },
                { name: 'clippings', label: 'Clippings', type: 'select', options: ['Bagging', 'Mulching', 'Side Discharge'] },
                { name: 'duration', label: 'Duration (minutes)', type: 'number', placeholder: '45' }
            ]
        },
        fertilizer: {
            name: 'Fertilizer & Treatments',
            icon: 'activity-fertilizer.png',
            color: 'bg-[#367C2B]',
            fields: [
                {
                    name: 'category',
                    label: 'Treatment Category',
                    type: 'treatment-category',
                    required: true
                },
                { 
                    name: 'product', 
                    label: 'Product', 
                    type: 'treatment-product',
                    placeholder: 'Select product...',
                    required: true
                },
                { 
                    name: 'spreader', 
                    label: 'Spreader/Applicator Used (Optional)', 
                    type: 'product-select', 
                    productType: 'spreaders',
                    placeholder: 'Select spreader (optional)...'
                },
                { 
                    name: 'applicationRate', 
                    label: 'Application Rate', 
                    type: 'text', 
                    placeholder: 'e.g., 0.5 oz per 1,000 sq ft'
                },
                { 
                    name: 'coverage', 
                    label: 'Coverage Area (sq ft)', 
                    type: 'number', 
                    placeholder: '5000',
                    min: 1,
                    max: 100000
                },
                { 
                    name: 'amountUsed', 
                    label: 'Total Amount Used', 
                    type: 'text', 
                    placeholder: 'e.g., 2.5 oz or 15 lbs'
                }
            ]
        },
        trimming: {
            name: 'Trimming Beds',
            icon: 'activity-trimming.png',
            color: 'bg-[#367C2B]',
            fields: [
                { name: 'areas', label: 'Areas Trimmed', type: 'text', placeholder: 'e.g., Front beds, side yard' },
                { name: 'toolUsed', label: 'Tool Used', type: 'select', options: ['String Trimmer', 'Edger', 'Hedge Trimmer', 'Hand Shears'] },
                { name: 'duration', label: 'Duration (minutes)', type: 'number', placeholder: '30' }
            ]
        },
        watering: {
            name: 'Watering',
            icon: 'activity-watering.png',
            color: 'bg-[#367C2B]',
            fields: [
                { name: 'method', label: 'Method', type: 'select', options: ['Sprinkler System', 'Hose', 'Hand Watering', 'Rain'] },
                { name: 'duration', label: 'Duration (minutes)', type: 'number', placeholder: '30' },
                { name: 'areas', label: 'Areas Watered', type: 'text', placeholder: 'e.g., Full lawn' }
            ]
        },
        seeding: {
            name: 'Seeding/Overseeding',
            icon: 'activity-fertilizer.png',
            color: 'bg-[#367C2B]',
            fields: [
                { 
                    name: 'product', 
                    label: 'Grass Seed Product', 
                    type: 'product-select', 
                    productType: 'seeds',
                    placeholder: 'Select seed...'
                },
                { 
                    name: 'spreader', 
                    label: 'Spreader Used', 
                    type: 'product-select', 
                    productType: 'spreaders',
                    placeholder: 'Select spreader...'
                },
                { name: 'spreaderSetting', label: 'Spreader Setting', type: 'text', placeholder: 'e.g., Setting 6 or J' },
                { name: 'applicationRate', label: 'Application Rate', type: 'text', placeholder: 'e.g., 5 lbs per 1000 sq ft' },
                { name: 'amountUsed', label: 'Amount Used (lbs)', type: 'number', placeholder: '25' },
                { name: 'areas', label: 'Areas Seeded', type: 'text', placeholder: 'e.g., Bare spots in backyard' }
            ]
        },
        aeration: {
            name: 'Aeration',
            icon: 'activity-aeration.png',
            color: 'bg-[#367C2B]',
            fields: [
                { name: 'method', label: 'Method', type: 'select', options: ['Core Aeration', 'Spike Aeration', 'Liquid Aeration'] },
                { name: 'equipment', label: 'Equipment', type: 'text', placeholder: 'e.g., Rental aerator' },
                { name: 'coverage', label: 'Coverage Area (sq ft)', type: 'number', placeholder: '5000' }
            ]
        },
        treatment: {
            name: 'Weed/Pest Treatment',
            icon: 'activity-fertilizer.png',
            color: 'bg-[#367C2B]',
            fields: [
                { name: 'treatmentType', label: 'Treatment Type', type: 'select', options: ['Herbicide', 'Pesticide', 'Fungicide', 'Pre-emergent'] },
                { 
                    name: 'product', 
                    label: 'Product', 
                    type: 'product-select-conditional', 
                    productType: 'herbicides', // Default
                    conditionalField: 'treatmentType',
                    productMap: {
                        'Herbicide': 'herbicides',
                        'Pesticide': 'pesticides',
                        'Fungicide': 'pesticides',
                        'Pre-emergent': 'herbicides'
                    },
                    placeholder: 'Select product...'
                },
                { 
                    name: 'spreader', 
                    label: 'Spreader Used (if granular)', 
                    type: 'product-select', 
                    productType: 'spreaders',
                    placeholder: 'Select spreader or leave blank for liquid spray'
                },
                { name: 'spreaderSetting', label: 'Spreader Setting (if used)', type: 'text', placeholder: 'e.g., Setting 3 or D' },
                { name: 'targetProblem', label: 'Target Problem', type: 'text', placeholder: 'e.g., Dandelions, grubs' },
                { name: 'applicationRate', label: 'Application Rate', type: 'text', placeholder: 'Per label instructions' },
                { name: 'areas', label: 'Areas Treated', type: 'text', placeholder: 'e.g., Backyard' }
            ]
        },
        maintenance: {
            name: 'Equipment Maintenance',
            icon: 'activity-maintenance.png',
            color: 'bg-[#367C2B]',
            fields: [
                { name: 'equipmentType', label: 'Equipment Type', type: 'select', options: ['Mower', 'Trimmer', 'Edger', 'Blower', 'Spreader', 'Aerator', 'Other'] },
                { name: 'maintenanceType', label: 'Maintenance Performed', type: 'select', options: ['Oil Change', 'Blade Sharpening', 'Spark Plug', 'Air Filter', 'Cleaning', 'General Service', 'Repair', 'Winterization'] },
                { name: 'equipmentModel', label: 'Equipment Model (Optional)', type: 'text', placeholder: 'e.g., Honda HRX217' },
                { name: 'partsReplaced', label: 'Parts Replaced (Optional)', type: 'text', placeholder: 'e.g., Air filter, spark plug' },
                { name: 'cost', label: 'Cost (Optional)', type: 'number', placeholder: '25' },
                { name: 'duration', label: 'Duration (minutes)', type: 'number', placeholder: '30' }
            ]
        }
    };

    // ==================== RESEARCH DATA - LAWN COACH v5.0 ====================
    // University research sources and zone/grass programs for accurate recommendations
    
    const RESEARCH_PROGRAMS = {
        'z5-tall-fescue': {
            fertilizer: { yearlyN: '3-4', schedule: [{m:4,n:0.5,p:'low'},{m:9,n:1.0,p:'high'},{m:10,n:1.0,p:'high'},{m:11,n:0.5,p:'low'}] },
            mowing: { spring:`3-3.5"`, summer:`3.5-4"`, fall:`3-3.5"` },
            preEmergent: { timing:'Early-mid April', soilTemp:'50-55Â°F' },
            overseeding: { window:'Sept 1-30', rate:'5-7 lbs' }
        },
        'z6-tall-fescue': {
            fertilizer: { yearlyN: '3-4', schedule: [{m:4,n:0.5,p:'low'},{m:9,n:1.0,p:'high'},{m:10,n:1.0,p:'high'},{m:11,n:0.5,p:'low'}] },
            mowing: { spring:`3-3.5"`, summer:`3.5-4"`, fall:`3-3.5"` },
            preEmergent: { timing:'Early-mid April', soilTemp:'50-55Â°F' },
            overseeding: { window:'Sept 1-30', rate:'5-7 lbs' }
        },
        'z6-kentucky-bluegrass': {
            fertilizer: { yearlyN: '3-5', schedule: [{m:4,n:0.5,p:'low'},{m:5,n:0.5,p:'low'},{m:9,n:1.5,p:'high'},{m:10,n:1.5,p:'high'},{m:11,n:1.0,p:'medium'}] },
            mowing: { spring:`2.5-3"`, summer:`3-3.5"`, fall:`2.5-3"` },
            preEmergent: { timing:'Early-mid April', soilTemp:'50-55Â°F' },
            overseeding: { window:'September', rate:'2-3 lbs', note:'Spreads via rhizomes, less critical' }
        },
        'z7-tall-fescue': {
            fertilizer: { yearlyN: '3-4', schedule: [{m:4,n:0.5,p:'low',note:'Light'},{m:9,n:1.25,p:'high',note:'Recovery'},{m:10,n:1.0,p:'high'},{m:11,n:0.5,p:'medium'}] },
            mowing: { spring:`3.5"`, summer:`4" CRITICAL`, fall:`3-3.5"`, note:'Transition zone - summer height critical' },
            preEmergent: { timing:'Late March-Early April', soilTemp:'50-55Â°F', note:'Earlier than Zone 6' },
            overseeding: { window:'Sept 1-30', rate:'6-8 lbs', note:'MORE critical - summer stress recovery' }
        },
        'z7-bermuda': {
            fertilizer: { yearlyN: '2-4', schedule: [{m:5,n:1.0,p:'high'},{m:6,n:1.0,p:'high'},{m:7,n:1.0,p:'medium'},{m:8,n:0.5,p:'low'}] },
            mowing: { height:`1-1.5"`, freq:'2-3x per week' },
            greenUp: { temp:'65Â°F soil', timing:'Late April-Early May' },
            dormancy: { temp:'50Â°F soil', timing:'Late Oct-Nov', months:'5-6 months brown' }
        },
        'z8-bermuda': {
            fertilizer: { yearlyN: '3-4', schedule: [{m:4,n:1.0,p:'high'},{m:5,n:1.0,p:'high'},{m:6,n:1.0,p:'high'},{m:7,n:0.5,p:'medium'},{m:8,n:0.5,p:'low'}] },
            mowing: { height:`1-1.5"`, freq:'2-3x per week' },
            greenUp: { temp:'65Â°F soil', timing:'Mid-late April' },
            dormancy: { temp:'50Â°F soil', timing:'Late Oct-Nov', months:'4-5 months brown' }
        }
    };

    // University research sources (compact version for citations)
    const RESEARCH_SOURCES = {
        'psu': { name: 'Penn State Extension', count: 3, url: 'https://extension.psu.edu/' },
        'purdue': { name: 'Purdue Extension', count: 2, url: 'https://www.purdue.edu/hla/sites/turf/' },
        'ncstate': { name: 'NC State Extension', count: 4, url: 'https://content.ces.ncsu.edu/' },
        'uga': { name: 'University of Georgia Extension', count: 4, url: 'https://extension.uga.edu/' },
        'tamu': { name: 'Texas A&M AgriLife Extension', count: 4, url: 'https://agrilifeextension.tamu.edu/' },
        'msu': { name: 'Michigan State Extension', count: 2, url: 'https://www.canr.msu.edu/turf/' }
    };

    // Get program for zone + grass combination
    const getProgram = (zone, grass) => {
        if (!zone || !grass) return null;
        const key = `z${zone}-${grass}`;
        return RESEARCH_PROGRAMS[key] || null;
    };

    function LawnCareTracker() {
        const [activities, setActivities] = useState([]);
        const [view, setView] = useState(null); // calendar, add, history, garage
        const [selectedMonth, setSelectedMonth] = useState(new Date());
        const [selectedActivityType, setSelectedActivityType] = useState(null);
        const [formData, setFormData] = useState({});
        const [weather, setWeather] = useState(null);
        const [weatherLoading, setWeatherLoading] = useState(true);
        const [weatherError, setWeatherError] = useState(null);
        const [showLocationInput, setShowLocationInput] = useState(false);
        const [manualLocation, setManualLocation] = useState('');
        const [usingMockData, setUsingMockData] = useState(false);
        const [showCalendar, setShowCalendar] = useState(true);
        const [equipment, setEquipment] = useState([]);
        const [lawnProfile, setLawnProfile] = useState(null);
        const [statsView, setStatsView] = useState('year'); // year, season, all
        const [showProfilePrompt, setShowProfilePrompt] = useState(false);

        // localStorage error handling wrapper
        const safeLocalStorage = {
            setItem: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return true;
                } catch (e) {
                    console.error('localStorage error:', e);
                    if (e.name === 'QuotaExceededError') {
                        alert('âš ï¸ Storage limit reached. Please export your data and clear old activities.');
                    }
                    return false;
                }
            },
            getItem: (key) => {
                try {
                    return localStorage.getItem(key);
                } catch (e) {
                    console.error('localStorage error:', e);
                    return null;
                }
            }
        };

        // Format large numbers with commas
        const formatNumber = (num) => {
            if (!num) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        };


        // Load activities from localStorage on mount
        useEffect(() => {
            const stored = localStorage.getItem('lawnCareActivities');
            if (stored) {
                setActivities(JSON.parse(stored));
            }
            
            // Load equipment from localStorage
            const storedEquipment = localStorage.getItem('lawnCareEquipment');
            if (storedEquipment) {
                setEquipment(JSON.parse(storedEquipment));
            }
            
            // Load lawn profile from localStorage
            const storedProfile = localStorage.getItem('lawnProfile');
            if (storedProfile) {
                setLawnProfile(JSON.parse(storedProfile));
            }
            
            // Fetch weather data
            fetchWeatherData();
        }, []);

        const fetchWeatherData = async (location = null) => {
            try {
                setWeatherLoading(true);
                setWeatherError(null);
                
                let latitude, longitude, locationName;
                
                // FORCE DEMO MODE - Always use built-in data
                const FORCE_DEMO_MODE = true;
                
                if (location) {
                    // Simple zip code to approximate coordinates mapping for common areas
                    const zipToCoords = {
                        '43235': { lat: 40.1014, lon: -83.0235, name: 'Columbus, OH' },
                        '10001': { lat: 40.7506, lon: -73.9971, name: 'New York, NY' },
                        '90001': { lat: 33.9731, lon: -118.2479, name: 'Los Angeles, CA' },
                        '60601': { lat: 41.8856, lon: -87.6178, name: 'Chicago, IL' },
                        '77001': { lat: 29.7499, lon: -95.3593, name: 'Houston, TX' },
                        '85001': { lat: 33.4484, lon: -112.0740, name: 'Phoenix, AZ' },
                        '19019': { lat: 39.9526, lon: -75.1652, name: 'Philadelphia, PA' },
                        '78701': { lat: 30.2672, lon: -97.7431, name: 'Austin, TX' },
                        '32801': { lat: 28.5383, lon: -81.3792, name: 'Orlando, FL' },
                        '98101': { lat: 47.6062, lon: -122.3321, name: 'Seattle, WA' }
                    };
                    
                    // Check if it's a known zip code
                    if (zipToCoords[location]) {
                        const coords = zipToCoords[location];
                        latitude = coords.lat;
                        longitude = coords.lon;
                        locationName = coords.name;
                    } else if (/^\d{5}$/.test(location)) {
                        // It's a zip code we don't have - ask for city name instead
                        throw new Error('Zip code not in database. Please try entering your city name and state (e.g., "Columbus, OH")');
                    } else {
                        // Parse manual coordinate entry or city approximation
                        const coordMatch = location.match(/^(-?\d+\.?\d*)\s*,\s*(-?\d+\.?\d*)$/);
                        if (coordMatch) {
                            latitude = parseFloat(coordMatch[1]);
                            longitude = parseFloat(coordMatch[2]);
                            locationName = 'Custom Location';
                        } else {
                            // Simple city name matching
                            const cityToCoords = {
                                'columbus': { lat: 40.1014, lon: -83.0235, name: 'Columbus, OH' },
                                'new york': { lat: 40.7506, lon: -73.9971, name: 'New York, NY' },
                                'los angeles': { lat: 33.9731, lon: -118.2479, name: 'Los Angeles, CA' },
                                'chicago': { lat: 41.8856, lon: -87.6178, name: 'Chicago, IL' },
                                'houston': { lat: 29.7499, lon: -95.3593, name: 'Houston, TX' },
                                'phoenix': { lat: 33.4484, lon: -112.0740, name: 'Phoenix, AZ' },
                                'philadelphia': { lat: 39.9526, lon: -75.1652, name: 'Philadelphia, PA' },
                                'austin': { lat: 30.2672, lon: -97.7431, name: 'Austin, TX' },
                                'orlando': { lat: 28.5383, lon: -81.3792, name: 'Orlando, FL' },
                                'seattle': { lat: 47.6062, lon: -122.3321, name: 'Seattle, WA' },
                                'miami': { lat: 25.7617, lon: -80.1918, name: 'Miami, FL' },
                                'denver': { lat: 39.7392, lon: -104.9903, name: 'Denver, CO' },
                                'boston': { lat: 42.3601, lon: -71.0589, name: 'Boston, MA' },
                                'san francisco': { lat: 37.7749, lon: -122.4194, name: 'San Francisco, CA' },
                                'atlanta': { lat: 33.7490, lon: -84.3880, name: 'Atlanta, GA' }
                            };
                            
                            const normalizedInput = location.toLowerCase().trim();
                            const cityMatch = Object.keys(cityToCoords).find(city => 
                                normalizedInput.includes(city)
                            );
                            
                            if (cityMatch) {
                                const coords = cityToCoords[cityMatch];
                                latitude = coords.lat;
                                longitude = coords.lon;
                                locationName = coords.name;
                            } else {
                                throw new Error('City not found. Try: coordinates (e.g., "40.1, -83.0"), a major city name, or zip code 43235');
                            }
                        }
                    }
                    
                    // Save location for future use
                    localStorage.setItem('savedLocation', JSON.stringify({ latitude, longitude, name: locationName }));
                } else {
                    // Try to get saved location first
                    const savedLocation = localStorage.getItem('savedLocation');
                    if (savedLocation) {
                        const parsed = JSON.parse(savedLocation);
                        latitude = parsed.latitude;
                        longitude = parsed.longitude;
                        locationName = parsed.name;
                    } else {
                        // Default to Columbus for demo
                        latitude = 40.1014;
                        longitude = -83.0235;
                        locationName = 'Columbus, OH (Demo)';
                        localStorage.setItem('savedLocation', JSON.stringify({ latitude, longitude, name: locationName }));
                    }
                }
                
                // Try to fetch real weather data, fall back to demo if unavailable
                let data;
                let isUsingDemo = false;
                
                try {
                    const weatherResponse = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,precipitation&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto&past_days=7`
                    );
                    
                    if (weatherResponse.ok) {
                        data = await weatherResponse.json();
                        isUsingDemo = false;
                    } else {
                        throw new Error('API unavailable');
                    }
                } catch (apiError) {
                    // Fallback to demo data if API fails
                    isUsingDemo = true;
                    
                    // REAL CURRENT WEATHER for Columbus, OH 43235 (January 31, 2026)
                    // Data source: National Weather Service & Weather Underground
                    data = {
                        current: {
                            temperature_2m: 16,  // Current temp: 16F
                            relative_humidity_2m: 70,  // Humidity: 70%
                            weather_code: 2,  // Partly cloudy
                            wind_speed_10m: 6  // Light winds ~6 mph
                        },
                        daily: {
                            temperature_2m_max: [16],  // High today: 16F
                            temperature_2m_min: [-7],  // Low tonight: -7F
                            precipitation_sum: [0, 0, 0, 0, 0, 0, 0]  // No recent precipitation
                        }
                    };
                }
                
                setUsingMockData(isUsingDemo);
                
                // Calculate approximate soil temperature
                const airTemp = data.current.temperature_2m;
                const soilTemp = Math.round(airTemp - 7);
                
                // Calculate weekly rainfall from precipitation data
                let weeklyRainfall = 0;
                if (data.daily && data.daily.precipitation_sum) {
                    weeklyRainfall = data.daily.precipitation_sum.reduce((sum, val) => sum + val, 0);
                    weeklyRainfall = Math.round(weeklyRainfall * 10) / 10; // Round to 1 decimal
                }
                
                setWeather({
                    temperature: Math.round(airTemp),
                    soilTemp: soilTemp,
                    humidity: data.current.relative_humidity_2m,
                    windSpeed: Math.round(data.current.wind_speed_10m),
                    weatherCode: data.current.weather_code,
                    highTemp: Math.round(data.daily.temperature_2m_max[0]),
                    lowTemp: Math.round(data.daily.temperature_2m_min[0]),
                    rainfall: weeklyRainfall,
                    location: locationName || 'Your Location'
                });
                
                setWeatherLoading(false);
                setShowLocationInput(false);
            } catch (error) {
                setWeatherError(error.message || 'Unable to load weather data');
                setWeatherLoading(false);
                setShowLocationInput(true);
            }
        };
        
        const handleManualLocationSubmit = (e) => {
            e.preventDefault();
            if (manualLocation.trim()) {
                fetchWeatherData(manualLocation.trim());
            }
        };

        const getWeatherDescription = (code) => {
            const weatherCodes = {
                0: { desc: 'Clear sky', icon: '' },
                1: { desc: 'Mainly clear', icon: '' },
                2: { desc: 'Partly cloudy', icon: '' },
                3: { desc: 'Overcast', icon: '' },
                45: { desc: 'Foggy', icon: '' },
                48: { desc: 'Foggy', icon: '' },
                51: { desc: 'Light drizzle', icon: '' },
                53: { desc: 'Drizzle', icon: '' },
                55: { desc: 'Heavy drizzle', icon: '' },
                61: { desc: 'Light rain', icon: '' },
                63: { desc: 'Rain', icon: '' },
                65: { desc: 'Heavy rain', icon: '' },
                71: { desc: 'Light snow', icon: '' },
                73: { desc: 'Snow', icon: '' },
                75: { desc: 'Heavy snow', icon: '' },
                95: { desc: 'Thunderstorm', icon: '' }
            };
            return weatherCodes[code] || { desc: 'Unknown', icon: '' };
        };

        // Save activities to localStorage whenever they change
        useEffect(() => {
            localStorage.setItem('lawnCareActivities', JSON.stringify(activities));
        }, [activities]);

        const addActivity = (activityData) => {
            const newActivity = {
                id: Date.now(),
                type: selectedActivityType,
                date: activityData.date,
                notes: activityData.notes,
                data: activityData.data,
                equipmentUsed: activityData.equipmentUsed || null,
                hoursLogged: activityData.hoursLogged || null,
                createdAt: new Date().toISOString()
            };
            const isFirstActivity = activities.length === 0;
            
            const updatedActivities = [...activities, newActivity];
            setActivities(updatedActivities);
            safeLocalStorage.setItem('lawnCareActivities', JSON.stringify(updatedActivities));
            
            // Update equipment hours if equipment was used
            if (activityData.equipmentUsed && activityData.hoursLogged) {
                updateEquipmentHours(activityData.equipmentUsed, activityData.hoursLogged);
            }
            
            // Track equipment maintenance
            if (selectedActivityType === 'maintenance' && activityData.equipmentUsed) {
                updateEquipmentMaintenance(activityData.equipmentUsed, {
                    date: activityData.date,
                    type: activityData.data.maintenanceType,
                    activityId: newActivity.id,
                    hoursAtMaintenance: equipment.find(e => e.id === activityData.equipmentUsed)?.currentHours || 0
                });
            }
            
            // Show profile prompt after first activity if profile not complete
            if (isFirstActivity && (!lawnProfile || !lawnProfile.grassType)) {
                setTimeout(() => setShowProfilePrompt(true), 500);
            }
            
            // Show success message
            alert('âœ… Activity saved successfully!');
            
            // Return to home page to see updated stats
            setView(null);
            setSelectedActivityType(null);
            setFormData({});
        };

        const deleteActivity = (id) => {
            if (confirm('Are you sure you want to delete this activity?')) {
                setActivities(activities.filter(a => a.id !== id));
            }
        };

        const addEquipment = (equipmentData) => {
            console.log('Adding equipment:', equipmentData);
            const newEquipment = {
                id: Date.now(),
                name: equipmentData.name,
                type: equipmentData.type,
                productId: equipmentData.productId,
                product: equipmentData.product,
                currentHours: equipmentData.currentHours || 0,
                maintenanceInterval: equipmentData.maintenanceInterval || null,
                lastMaintenance: equipmentData.lastMaintenance || null,
                createdAt: new Date().toISOString()
            };
            const updatedEquipment = [...equipment, newEquipment];
            console.log('Updated equipment list:', updatedEquipment);
            setEquipment(updatedEquipment);
            localStorage.setItem('lawnCareEquipment', JSON.stringify(updatedEquipment));
        };

        const updateEquipmentHours = (equipmentId, hoursToAdd) => {
            const updatedEquipment = equipment.map(item => {
                if (item.id === equipmentId) {
                    return {
                        ...item,
                        currentHours: (item.currentHours || 0) + parseFloat(hoursToAdd)
                    };
                }
                return item;
            });
            setEquipment(updatedEquipment);
            localStorage.setItem('lawnCareEquipment', JSON.stringify(updatedEquipment));
        };

        const logMaintenance = (equipmentId) => {
            const updatedEquipment = equipment.map(item => {
                if (item.id === equipmentId) {
                    return {
                        ...item,
                        lastMaintenance: item.currentHours || 0
                    };
                }
                return item;
            });
            setEquipment(updatedEquipment);
            localStorage.setItem('lawnCareEquipment', JSON.stringify(updatedEquipment));
        };

        const deleteEquipment = (id) => {
            if (confirm('Are you sure you want to remove this equipment?')) {
                const updatedEquipment = equipment.filter(e => e.id !== id);
                setEquipment(updatedEquipment);
                localStorage.setItem('lawnCareEquipment', JSON.stringify(updatedEquipment));
            }
        };

        const getEquipmentByType = (type) => {
            return equipment.filter(e => e.type === type);
        };

        const getDaysInMonth = (date) => {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            return { daysInMonth, startingDayOfWeek, year, month };
        };

        const getActivitiesForDate = (date) => {
            const dateStr = date.toISOString().split('T')[0];
            return activities.filter(a => a.date === dateStr);
        };

        const WeatherSnapshot = () => {
            if (weatherLoading) {
                return (
                    <div className="bg-white rounded-lg shadow p-6 mb-6 border border-gray-200">
                        <div className="text-gray-600 text-center">
                            <div className="animate-pulse">Loading weather data...</div>
                        </div>
                    </div>
                );
            }

            if (weatherError || showLocationInput) {
                return (
                    <div className="bg-white rounded-lg shadow p-6 mb-6 border border-gray-200">
                        <div className="text-gray-800">
                            <h2 className="text-xl font-bold mb-4 text-gray-800">ðŸŒ¿ Lawn Conditions</h2>
                            
                            {weatherError && (
                                <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                                    <p className="mb-2 text-orange-800">ðŸ“ {weatherError}</p>
                                </div>
                            )}
                            
                            <div className="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                <p className="mb-3 font-semibold text-gray-700">Enter your location:</p>
                                <form onSubmit={handleManualLocationSubmit} className="flex gap-2">
                                    <input
                                        type="text"
                                        value={manualLocation}
                                        onChange={(e) => setManualLocation(e.target.value)}
                                        placeholder="43235, Columbus, or coordinates"
                                        className="flex-1 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                    />
                                    <button
                                        type="submit"
                                        className="px-6 py-2 bg-[#367C2B] text-white rounded-lg hover:bg-[#2d6323] font-semibold"
                                    >
                                        Get Weather
                                    </button>
                                </form>
                                <p className="text-sm mt-2 text-gray-500">Examples: "43235", "Columbus", "40.1, -83.0"</p>
                            </div>
                            
                            {!showLocationInput && (
                                <div className="text-center mt-4">
                                    <button
                                        onClick={() => {
                                            setWeatherError(null);
                                            fetchWeatherData();
                                        }}
                                        className="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 text-sm"
                                    >
                                        Try Auto-Detect Again
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (!weather) return null;

            const weatherInfo = getWeatherDescription(weather.weatherCode);
            
            // Determine lawn care conditions
            const getLawnCondition = () => {
                if (weather.temperature < 32) return { 
                    text: 'Too Cold for Lawn Care', 
                    color: 'bg-blue-50 text-blue-800 border-blue-200', 
                    icon: '',
                    detail: 'Grass is dormant. Avoid foot traffic on frozen turf.'
                };
                if (weather.temperature > 95) return { 
                    text: 'Too Hot - Avoid Stress', 
                    color: 'bg-red-50 text-red-800 border-red-200', 
                    icon: '',
                    detail: 'Water deeply in early morning. Avoid mowing or treatments.'
                };
                if (weather.soilTemp < 50) return { 
                    text: 'Soil Too Cold for Seeding', 
                    color: 'bg-blue-50 text-blue-800 border-blue-200', 
                    icon: '',
                    detail: 'Wait for soil to warm to 50F+ before seeding.'
                };
                if (weather.soilTemp >= 50 && weather.soilTemp <= 65) return { 
                    text: 'Good for Cool-Season Grass', 
                    color: 'bg-[#e9f2e6] text-[#367C2B] border-[#7ba870]', 
                    icon: '',
                    detail: 'Ideal for fescue, ryegrass, and bluegrass growth.'
                };
                if (weather.soilTemp >= 65 && weather.soilTemp <= 75) return { 
                    text: 'Ideal Growing Conditions', 
                    color: 'bg-[#e9f2e6] text-[#367C2B] border-[#7ba870]', 
                    icon: '',
                    detail: 'Perfect weather for most lawn activities and treatments.'
                };
                if (weather.soilTemp > 75) return { 
                    text: 'Good for Warm-Season Grass', 
                    color: 'bg-[#e9f2e6] text-[#367C2B] border-[#7ba870]', 
                    icon: '',
                    detail: 'Ideal for bermuda, zoysia, and St. Augustine.'
                };
                return { 
                    text: 'Good Lawn Care Weather', 
                    color: 'bg-[#e9f2e6] text-[#367C2B] border-[#7ba870]', 
                    icon: '',
                    detail: 'Suitable conditions for most lawn maintenance.'
                };
            };

            const condition = getLawnCondition();
            
            // Get top recommendation
            const topRecommendation = calculateRecommendations()[0];

            return (
                <div className="mb-6">
                    {/* Demo Mode Banner */}
                    {usingMockData && (
                        <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-3 mb-4 shadow-sm">
                            <p className="text-xs text-yellow-800 font-medium">
                                 Demo Mode: Showing example weather data (API unavailable)
                            </p>
                        </div>
                    )}
                    
                    {/* Coach's Corner - Show Top Recommendation or Weather Advice */}
                    {topRecommendation ? (
                        <div className="rounded-xl p-4 shadow-xl mb-4 border-2 border-white bg-[#367C2B]">
                            <div className="flex items-start gap-3">
                                <img 
                                    src={weather.temperature <= 32 ? "coach-winter.png" : "coach-icon.png"} 
                                    alt="Coach" 
                                    className="w-16 h-16 object-contain flex-shrink-0" 
                                />
                                <div className="flex-1">
                                    <div className="text-xs font-bold uppercase tracking-widest mb-1 text-white/80">ðŸ† Coach's Corner</div>
                                    <div className="flex items-center gap-2 mb-1">
                                        {topRecommendation.priority === 'high' && <span className="text-lg">ðŸ”´</span>}
                                        {topRecommendation.priority === 'medium' && <span className="text-lg">ðŸŸ¡</span>}
                                        <div className="font-bold text-xl text-white" style={{textShadow: '2px 2px 4px rgba(0,0,0,0.2)'}}>
                                            {topRecommendation.title}
                                        </div>
                                    </div>
                                    <div className="text-sm text-white/95 leading-relaxed mb-2">{topRecommendation.reason}</div>
                                    <div className="flex gap-2 mt-3">
                                        <button
                                            onClick={() => {
                                                setSelectedActivityType(topRecommendation.action);
                                                setView('add');
                                            }}
                                            className="px-4 py-2 bg-white text-[#367C2B] rounded-lg font-semibold hover:bg-gray-100 transition text-sm"
                                        >
                                            {topRecommendation.icon} Log Now
                                        </button>
                                        <button
                                            onClick={() => { setView('recommendations'); }}
                                            className="px-4 py-2 bg-white/20 text-white rounded-lg font-semibold hover:bg-white/30 transition text-sm border border-white/30"
                                        >
                                            View All ({calculateRecommendations().length})
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="rounded-xl p-4 shadow-xl mb-4 border-2 border-white bg-[#367C2B]">
                            <div className="flex items-start gap-3">
                                <img 
                                    src={weather.temperature <= 32 ? "coach-winter.png" : "coach-icon.png"} 
                                    alt="Coach" 
                                    className="w-16 h-16 object-contain flex-shrink-0" 
                                />
                                <div className="flex-1">
                                    <div className="text-xs font-bold uppercase tracking-widest mb-1 text-white/80">ðŸ† Coach's Corner</div>
                                    <div className="font-bold text-xl mb-1 text-white" style={{textShadow: '2px 2px 4px rgba(0,0,0,0.2)'}}>{condition.text}</div>
                                    <div className="text-sm text-white/95 leading-relaxed">{condition.detail}</div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Main Stats Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                        {/* Current Conditions */}
                        <div className="bg-white rounded-xl shadow-lg border-2 border-[#367C2B]/20 p-4">
                            <h3 className="text-xs font-bold text-[#367C2B] uppercase tracking-wider mb-3">Current Conditions</h3>
                            <div className="grid grid-cols-2 gap-3">
                                {/* Left: Icon and Temp */}
                                <div className="flex flex-col items-center justify-center border-r-2 border-[#367C2B]/20">
                                    <div className="text-4xl mb-1">{weatherInfo.icon}</div>
                                    <div className="text-3xl font-bold text-[#367C2B]">{weather.temperature}Â°</div>
                                </div>
                                
                                {/* Right: Details */}
                                <div className="flex flex-col justify-center space-y-1">
                                    <div className="text-sm font-bold text-gray-900">{weatherInfo.desc}</div>
                                    <div className="text-xs text-gray-600">High {weather.highTemp}Â° â€¢ Low {weather.lowTemp}Â°</div>
                                    <div className="text-xs text-gray-600 pt-1 border-t border-gray-100">
                                         {weather.humidity}%
                                    </div>
                                    <div className="text-xs text-gray-600">
                                         {weather.windSpeed} mph
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        {/* Soil Temp & Rainfall */}
                        <div className="bg-white rounded-xl shadow-lg border-2 border-[#367C2B]/20 p-4">
                            <h3 className="text-xs font-bold text-[#367C2B] uppercase tracking-wider mb-3">Ground Conditions</h3>
                            <div className="grid grid-cols-2 gap-3">
                                {/* Soil Temperature */}
                                <div className="flex flex-col justify-center border-r-2 border-[#367C2B]/20">
                                    <div className="text-xs text-[#367C2B] mb-1 font-semibold">SOIL TEMP</div>
                                    <div className="text-3xl font-bold text-[#367C2B] mb-1">{weather.soilTemp}Â°</div>
                                    <div className="text-xs text-gray-500">at 4" depth</div>
                                </div>
                                
                                {/* Rainfall */}
                                <div className="flex flex-col justify-center">
                                    <div className="text-xs text-[#367C2B] mb-1 font-semibold">RAINFALL</div>
                                    <div className="text-3xl font-bold text-[#367C2B] mb-1">{weather.rainfall}"</div>
                                    <div className="text-xs text-gray-500">this week</div>
                                </div>
                            </div>
                            <div className={`text-sm font-bold mt-3 pt-3 border-t-2 border-gray-100 text-center ${
                                weather.rainfall >= 1 ? 'text-[#367C2B]' : 'text-orange-600'
                            }`}>
                                {weather.rainfall >= 1 ? ' Adequate water' : ' May need watering'}
                            </div>
                        </div>
                    </div>
                    
                    {/* Location Info - Small and Subtle */}
                    <div className="flex items-center justify-center gap-3 mb-4 text-xs text-gray-500">
                        {weather.location && (
                            <span className="flex items-center gap-1">
                                 {weather.location}
                            </span>
                        )}
                        <span className="text-gray-300">â€¢</span>
                        <button
                            onClick={() => setShowLocationInput(true)}
                            className="text-gray-500 hover:text-[#367C2B] transition font-medium"
                        >
                            Change Location
                        </button>
                        <span className="text-gray-300">â€¢</span>
                        <button
                            onClick={() => fetchWeatherData()}
                            className="text-gray-500 hover:text-[#367C2B] transition font-medium"
                        >
                            Refresh
                        </button>
                    </div>
                    
                    {/* Last Activity */}
                    <div className="bg-white rounded-xl shadow-lg border-2 border-[#367C2B]/30 p-4 mb-3">
                        <h3 className="text-xs font-bold text-[#367C2B] uppercase tracking-wider mb-3">Last Activity</h3>
                        {activities.length > 0 ? (
                            <div className="flex items-center gap-3">
                                <img 
                                    src={ACTIVITY_TYPES[activities[activities.length - 1].type].icon}
                                    alt={ACTIVITY_TYPES[activities[activities.length - 1].type].name}
                                    className="w-16 h-16 rounded-lg object-cover shadow-sm"
                                />
                                <div className="flex-1">
                                    <div className="text-base font-bold text-[#367C2B]">
                                        {ACTIVITY_TYPES[activities[activities.length - 1].type].name}
                                    </div>
                                    <div className="text-xs text-gray-600 mt-1">
                                        {(() => {
                                            const lastActivity = activities[activities.length - 1];
                                            const daysSince = Math.floor((new Date() - new Date(lastActivity.date)) / (1000 * 60 * 60 * 24));
                                            return daysSince === 0 ? 'Today' : daysSince === 1 ? 'Yesterday' : `${daysSince} days ago`;
                                        })()}
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="text-center py-3">
                                <div className="text-gray-400 text-3xl mb-1">ðŸ“‹</div>
                                <div className="text-sm text-gray-500 font-medium">No activities yet</div>
                                <div className="text-xs text-gray-400 mt-0.5">Add your first activity to get started</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const CalendarView = () => {
            const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(selectedMonth);
            const days = [];
            
            // Add empty cells for days before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                days.push(<div key={`empty-${i}`} className="h-24 bg-gray-100"></div>);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayActivities = getActivitiesForDate(date);
                const isToday = new Date().toDateString() === date.toDateString();
                
                days.push(
                    <div key={day} className={`h-24 border border-gray-200 p-1 overflow-y-auto ${isToday ? 'bg-blue-50 ring-2 ring-blue-400' : 'bg-white'}`}>
                        <div className="font-semibold text-sm mb-1">{day}</div>
                        {dayActivities.map(activity => (
                            <div key={activity.id} className={`text-xs ${ACTIVITY_TYPES[activity.type].color} text-white px-1 py-0.5 rounded mb-0.5 truncate`}>
                                {ACTIVITY_TYPES[activity.type].icon} {ACTIVITY_TYPES[activity.type].name}
                            </div>
                        ))}
                    </div>
                );
            }
            
            return (
                <div>
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex items-center gap-4">
                            <button
                                onClick={() => setShowCalendar(!showCalendar)}
                                className="px-4 py-2 bg-[#367C2B] text-white rounded-lg shadow hover:bg-[#2d6323] font-semibold"
                            >
                                {showCalendar ? ' Hide Calendar' : ' Show Calendar'}
                            </button>
                            {showCalendar && (
                                <>
                                    <button
                                        onClick={() => setSelectedMonth(new Date(selectedMonth.setMonth(selectedMonth.getMonth() - 1)))}
                                        className="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50"
                                    >
                                         Prev
                                    </button>
                                    <h2 className="text-2xl font-bold">
                                        {selectedMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                                    </h2>
                                    <button
                                        onClick={() => setSelectedMonth(new Date(selectedMonth.setMonth(selectedMonth.getMonth() + 1)))}
                                        className="px-4 py-2 bg-white rounded-lg shadow hover:bg-gray-50"
                                    >
                                        Next 
                                    </button>
                                </>
                            )}
                        </div>
                    </div>
                    
                    {showCalendar && (
                        <div className="bg-white rounded-lg shadow-lg p-4">
                            <div className="grid grid-cols-7 gap-1 mb-2">
                                {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                                    <div key={day} className="font-bold text-center text-sm py-2">{day}</div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-1">
                                {days}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const MyGarage = () => {
            const [selectedType, setSelectedType] = useState('mowers');
            const [localGarageForm, setLocalGarageForm] = useState({ 
                name: '', 
                type: 'mowers', 
                productId: '', 
                currentHours: 0,
                maintenanceInterval: 50,
                customMowerName: '',
                trimmerManufacturer: '',
                trimmerEngineType: '',
                trimmerLineSize: ''
            });
            const [expandedEquipment, setExpandedEquipment] = useState(null);
            const [showMaintenanceInfo, setShowMaintenanceInfo] = useState({});
            
            const productTypes = {
                mowers: { label: 'Lawn Mowers', products: PRODUCT_DATABASE.mowers },
                spreaders: { label: 'Spreaders', products: PRODUCT_DATABASE.spreaders },
                trimmers: { label: 'String Trimmers/Edgers', products: PRODUCT_DATABASE.trimmers },
                other: { label: 'Other Equipment', products: [] }
            };

            const handleAddEquipment = (e) => {
                e.preventDefault();
                console.log('Form submitted:', localGarageForm);
                
                if (!localGarageForm.name) {
                    alert('Please enter an equipment name');
                    return;
                }
                
                if (localGarageForm.name && localGarageForm.type) {
                    const selectedProduct = 
                        selectedType === 'mowers' ? PRODUCT_DATABASE.mowers.find(p => p.id === localGarageForm.productId) :
                        selectedType === 'spreaders' ? PRODUCT_DATABASE.spreaders.find(p => p.id === localGarageForm.productId) :
                        selectedType === 'trimmers' ? PRODUCT_DATABASE.trimmers.find(p => p.id === localGarageForm.productId) :
                        null;
                    
                    // Use custom mower name if "Other" is selected
                    let finalProduct = selectedProduct;
                    if (selectedType === 'mowers' && localGarageForm.productId === 'm-other' && localGarageForm.customMowerName) {
                        finalProduct = {
                            ...selectedProduct,
                            name: localGarageForm.customMowerName,
                            brand: 'Other',
                            customName: localGarageForm.customMowerName
                        };
                    }
                    
                    // Use custom trimmer details if "Other" is selected
                    if (selectedType === 'trimmers' && localGarageForm.productId === 't-other') {
                        finalProduct = {
                            id: 't-other',
                            name: localGarageForm.trimmerManufacturer || 'Custom Trimmer',
                            brand: localGarageForm.trimmerManufacturer || 'Other',
                            engineType: localGarageForm.trimmerEngineType,
                            lineSize: localGarageForm.trimmerLineSize,
                            type: 'Custom'
                        };
                    }
                    
                    addEquipment({
                        name: localGarageForm.name,
                        type: selectedType,
                        productId: localGarageForm.productId,
                        product: finalProduct,
                        currentHours: selectedType === 'mowers' ? (parseFloat(localGarageForm.currentHours) || 0) : 0,
                        maintenanceInterval: selectedType === 'mowers' ? (parseFloat(localGarageForm.maintenanceInterval) || null) : null
                    });
                    
                    alert(`âœ… ${localGarageForm.name} added to your garage!`);
                    
                    // Reset form
                    setLocalGarageForm({ 
                        name: '', 
                        type: 'mowers', 
                        productId: '', 
                        currentHours: 0,
                        maintenanceInterval: 50,
                        customMowerName: '',
                        trimmerManufacturer: '',
                        trimmerEngineType: '',
                        trimmerLineSize: ''
                    });
                    setSelectedType('mowers');
                }
            };

            return (
                <div>
                    <h2 className="text-xl font-bold mb-4 text-gray-900">ðŸ  My Garage</h2>
                    <p className="text-sm text-gray-600 mb-4">Store your personal equipment to quickly select it when logging activities.</p>
                    
                    {/* Add Equipment Form */}
                    <div className="bg-white rounded-lg shadow border border-gray-200 p-4 mb-4">
                        <h3 className="text-lg font-bold mb-4 text-gray-800">Add Equipment</h3>
                        <form onSubmit={handleAddEquipment}>
                            <div className="mb-4">
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Equipment Name</label>
                                <input
                                    type="text"
                                    placeholder="e.g., My Honda HRX, Red Echo Spreader"
                                    value={localGarageForm.name}
                                    onChange={(e) => setLocalGarageForm({...localGarageForm, name: e.target.value})}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-sm font-semibold mb-2 text-gray-700">Equipment Type</label>
                                <select
                                    value={selectedType}
                                    onChange={(e) => {
                                        setSelectedType(e.target.value);
                                        setLocalGarageForm({...localGarageForm, type: e.target.value, productId: ''});
                                    }}
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                >
                                    <option value="mowers">Lawn Mower</option>
                                    <option value="spreaders">Spreader</option>
                                    <option value="trimmers">String Trimmer/Edger</option>
                                    <option value="other">Other Equipment</option>
                                </select>
                            </div>

                            {(selectedType === 'mowers' || selectedType === 'spreaders' || selectedType === 'trimmers') && (
                                <div className="mb-4">
                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Select Product (Optional)</label>
                                    <select
                                        value={localGarageForm.productId}
                                        onChange={(e) => {
                                            const productId = e.target.value;
                                            const selectedProduct = (
                                                selectedType === 'mowers' ? PRODUCT_DATABASE.mowers :
                                                selectedType === 'spreaders' ? PRODUCT_DATABASE.spreaders :
                                                PRODUCT_DATABASE.trimmers
                                            ).find(p => p.id === productId);
                                            
                                            // Auto-populate maintenance interval from product if available
                                            const maintenanceInterval = selectedProduct?.maintenanceSchedule?.oilChange || localGarageForm.maintenanceInterval;
                                            
                                            setLocalGarageForm({
                                                ...localGarageForm, 
                                                productId: productId,
                                                maintenanceInterval: maintenanceInterval,
                                                trimmerManufacturer: selectedProduct?.brand || '',
                                                trimmerEngineType: selectedProduct?.engineType || '',
                                                trimmerLineSize: selectedProduct?.lineSize || ''
                                            });
                                        }}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                    >
                                        <option value="">Choose a product...</option>
                                        {(
                                            selectedType === 'mowers' ? PRODUCT_DATABASE.mowers :
                                            selectedType === 'spreaders' ? PRODUCT_DATABASE.spreaders :
                                            PRODUCT_DATABASE.trimmers
                                        ).map(product => (
                                            <option key={product.id} value={product.id}>
                                                {product.brand} - {product.name}
                                            </option>
                                        ))}
                                    </select>
                                    {localGarageForm.productId && selectedType === 'mowers' && (() => {
                                        const selectedProduct = PRODUCT_DATABASE.mowers.find(p => p.id === localGarageForm.productId);
                                        if (selectedProduct?.maintenanceSchedule?.oilChange) {
                                            return (
                                                <p className="text-xs text-[#367C2B] mt-1">
                                                     Manufacturer recommends oil change every {selectedProduct.maintenanceSchedule.oilChange} hours
                                                </p>
                                            );
                                        }
                                    })()}
                                </div>
                            )}

                            {/* Custom Mower Name for "Other" */}
                            {selectedType === 'mowers' && localGarageForm.productId === 'm-other' && (
                                <div className="mb-4">
                                    <label className="block text-sm font-semibold mb-2 text-gray-700">Mower Name/Model</label>
                                    <input
                                        type="text"
                                        placeholder="e.g., John Deere X350, Kubota GR2120"
                                        value={localGarageForm.customMowerName}
                                        onChange={(e) => setLocalGarageForm({...localGarageForm, customMowerName: e.target.value})}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                    />
                                </div>
                            )}

                            {/* Trimmer Details */}
                            {selectedType === 'trimmers' && localGarageForm.productId === 't-other' && (
                                <>
                                    <div className="mb-4">
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Manufacturer</label>
                                        <input
                                            type="text"
                                            placeholder="e.g., Echo, Stihl, Husqvarna"
                                            value={localGarageForm.trimmerManufacturer}
                                            onChange={(e) => setLocalGarageForm({...localGarageForm, trimmerManufacturer: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                        />
                                    </div>
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-700">Engine Type</label>
                                            <select
                                                value={localGarageForm.trimmerEngineType}
                                                onChange={(e) => setLocalGarageForm({...localGarageForm, trimmerEngineType: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                            >
                                                <option value="">Select...</option>
                                                <option value="Gas">Gas</option>
                                                <option value="Electric">Electric (Battery/Corded)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-semibold mb-2 text-gray-700">Line Size (Optional)</label>
                                            <input
                                                type="text"
                                                placeholder='e.g., .095", .080"'
                                                value={localGarageForm.trimmerLineSize}
                                                onChange={(e) => setLocalGarageForm({...localGarageForm, trimmerLineSize: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                            />
                                        </div>
                                    </div>
                                </>
                            )}

                            {selectedType === 'mowers' && (
                                <div className="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Current Hours</label>
                                        <input
                                            type="number"
                                            step="0.1"
                                            placeholder="0"
                                            value={localGarageForm.currentHours}
                                            onChange={(e) => setLocalGarageForm({...localGarageForm, currentHours: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Starting hour meter reading</p>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold mb-2 text-gray-700">Maintenance Interval</label>
                                        <input
                                            type="number"
                                            step="1"
                                            placeholder="50"
                                            value={localGarageForm.maintenanceInterval}
                                            onChange={(e) => setLocalGarageForm({...localGarageForm, maintenanceInterval: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                        />
                                        <p className="text-xs text-gray-500 mt-1">Hours between service</p>
                                    </div>
                                </div>
                            )}

                            <button
                                type="submit"
                                className="w-full px-4 py-2 bg-[#367C2B] text-white rounded-lg hover:bg-[#2d6323] font-semibold"
                            >
                                Add to Garage
                            </button>
                        </form>
                    </div>

                    {/* Equipment List */}
                    <div className="bg-white rounded-lg shadow border border-gray-200 p-4">
                        <h3 className="text-lg font-bold mb-4 text-gray-800">Your Equipment</h3>
                        {equipment.length === 0 ? (
                            <div className="text-center py-6">
                                <div className="text-gray-400 text-3xl mb-2">ðŸœï¸</div>
                                <p className="text-gray-500">Your garage is empty. Add some equipment!</p>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                {equipment.map(item => {
                                    const hoursSinceMaintenance = item.lastMaintenance !== null 
                                        ? (item.currentHours || 0) - item.lastMaintenance 
                                        : item.currentHours || 0;
                                    const needsMaintenance = item.maintenanceInterval 
                                        ? hoursSinceMaintenance >= item.maintenanceInterval 
                                        : false;
                                    
                                    return (
                                        <div key={item.id} className="bg-white rounded-lg border-2 border-gray-200 shadow-sm">
                                            {/* Equipment Header - Always Visible */}
                                            <div className="p-4">
                                                <div className="flex items-start justify-between mb-2">
                                                    <div className="flex-1">
                                                        <div className="font-bold text-lg text-gray-900">
                                                            {item.name}
                                                        </div>
                                                        <div className="text-sm text-gray-600 capitalize mt-1">{item.type}</div>
                                                        {item.product && (
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                {item.product.brand} â€¢ {item.product.type}
                                                            </div>
                                                        )}
                                                    </div>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            deleteEquipment(item.id);
                                                        }}
                                                        className="px-3 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 text-xs font-semibold"
                                                    >
                                                        Remove
                                                    </button>
                                                </div>
                                                
                                                {/* See Maintenance Info Toggle - Only for Mowers */}
                                                {item.type === 'mowers' && (
                                                    <button
                                                        onClick={() => setShowMaintenanceInfo({
                                                            ...showMaintenanceInfo,
                                                            [item.id]: !showMaintenanceInfo[item.id]
                                                        })}
                                                        className="mt-3 text-sm text-[#367C2B] hover:text-[#2d6323] font-semibold underline"
                                                    >
                                                        {showMaintenanceInfo[item.id] ? 'âˆ’ Hide' : '+ See'} Maintenance Info
                                                    </button>
                                                )}
                                            </div>
                                            
                                            {/* Collapsible Maintenance Section - Only for Mowers */}
                                            {item.type === 'mowers' && showMaintenanceInfo[item.id] && (
                                                <div className="px-4 pb-4 border-t-2 border-gray-100 pt-4">
                                                    {/* Hour Meter Display */}
                                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                                            <div className="text-xs text-gray-500 font-medium mb-1">Current Hours</div>
                                                            <div className="text-2xl font-bold text-gray-900">{(item.currentHours || 0).toFixed(1)}</div>
                                                        </div>
                                                        <div className="bg-gray-50 p-3 rounded-lg border border-gray-200">
                                                            <div className="text-xs text-gray-500 font-medium mb-1">Since Maintenance</div>
                                                            <div className={`text-2xl font-bold ${needsMaintenance ? 'text-red-600' : 'text-gray-900'}`}>
                                                                {hoursSinceMaintenance.toFixed(1)}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    {/* Maintenance Status */}
                                                    {item.maintenanceInterval && (
                                                        <div className="mb-3">
                                                            {needsMaintenance ? (
                                                                <div className="bg-red-50 border-2 border-red-200 rounded-lg p-3 text-sm text-red-700 font-semibold">
                                                                     Maintenance Due! (Interval: {item.maintenanceInterval} hours)
                                                                </div>
                                                            ) : (
                                                                <div className="bg-green-50 border-2 border-green-200 rounded-lg p-3 text-sm text-green-700 font-semibold">
                                                                     Next service in {(item.maintenanceInterval - hoursSinceMaintenance).toFixed(1)} hours (Interval: {item.maintenanceInterval} hours)
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                    
                                                    {/* Manufacturer Maintenance Schedule */}
                                                    {item.product?.maintenanceSchedule && (
                                                        <div className="mb-3 p-3 bg-blue-50 border-2 border-blue-200 rounded-lg">
                                                            <div className="font-semibold text-blue-900 text-sm mb-2">
                                                                 Manufacturer Maintenance Schedule
                                                            </div>
                                                            <div className="space-y-1 text-xs text-blue-800">
                                                                {item.product.maintenanceSchedule.oilChange && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Oil Change:</span>
                                                                        <span>Every {item.product.maintenanceSchedule.oilChange} hours</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.airFilter && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Air Filter:</span>
                                                                        <span>{typeof item.product.maintenanceSchedule.airFilter === 'number' ? `Every ${item.product.maintenanceSchedule.airFilter} hours` : item.product.maintenanceSchedule.airFilter}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.sparkPlug && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Spark Plug:</span>
                                                                        <span>{typeof item.product.maintenanceSchedule.sparkPlug === 'number' ? `Every ${item.product.maintenanceSchedule.sparkPlug} hours` : item.product.maintenanceSchedule.sparkPlug}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.bladeService && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Blade Service:</span>
                                                                        <span>{item.product.maintenanceSchedule.bladeService}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.cleaning && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Cleaning:</span>
                                                                        <span>{item.product.maintenanceSchedule.cleaning}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.lubrication && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Lubrication:</span>
                                                                        <span>{item.product.maintenanceSchedule.lubrication}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.battery && (
                                                                    <div className="flex justify-between">
                                                                        <span className="font-medium">Battery:</span>
                                                                        <span>{item.product.maintenanceSchedule.battery}</span>
                                                                    </div>
                                                                )}
                                                                {item.product.maintenanceSchedule.note && (
                                                                    <div className="mt-2 pt-2 border-t border-blue-300 text-blue-700 font-medium">
                                                                         {item.product.maintenanceSchedule.note}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {/* Log Maintenance Button */}
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            if (confirm(`Log maintenance for ${item.name} at ${(item.currentHours || 0).toFixed(1)} hours?`)) {
                                                                logMaintenance(item.id);
                                                                alert(` Maintenance logged! Hour meter reset to 0 hours since last service.`);
                                                            }
                                                        }}
                                                        className="w-full px-4 py-2.5 bg-[#367C2B] text-white rounded-lg hover:bg-[#2d6323] text-sm font-semibold"
                                                    >
                                                         Log Maintenance
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>

                    <button
                        onClick={() => setView('calendar')}
                        className="mt-4 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium"
                    >
                        Back
                    </button>
                </div>
            );
        };

        const ActivitySelector = () => {
            return (
                <div>
                    <h2 className="text-xl font-bold mb-4 text-gray-900">Select Activity Type</h2>
                    <div className="grid grid-cols-2 gap-3">
                        {Object.entries(ACTIVITY_TYPES).map(([key, type]) => (
                            <button
                                key={key}
                                onClick={() => setSelectedActivityType(key)}
                                className="bg-white border-2 border-[#367C2B]/30 hover:border-[#367C2B] p-4 rounded-xl shadow-md hover:shadow-xl transition-all flex items-center gap-3 min-h-[100px] group"
                            >
                                <img 
                                    src={type.icon} 
                                    alt={type.name} 
                                    className="w-20 h-20 rounded-lg object-cover flex-shrink-0 shadow-sm group-hover:shadow-md transition-shadow" 
                                />
                                <div className="text-sm font-bold leading-tight text-left flex-1 break-words pr-2 text-[#367C2B] group-hover:text-[#2d6323] transition-colors">
                                    {type.name}
                                </div>
                            </button>
                        ))}
                    </div>
                    <button
                        onClick={() => setView(null)}
                        className="mt-4 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm font-medium"
                    >
                        Cancel
                    </button>
                </div>
            );
        };

        const ActivityForm = () => {
            const activityType = ACTIVITY_TYPES[selectedActivityType];
            const [localFormData, setLocalFormData] = useState({
                date: new Date().toISOString().split('T')[0],
                notes: '',
                data: {},
                equipmentUsed: null,
                hoursLogged: null
            });
            const [selectedProducts, setSelectedProducts] = useState({});
            const [selectedEquipmentId, setSelectedEquipmentId] = useState(null);
            const [validationErrors, setValidationErrors] = useState({});
            const [showOtherInput, setShowOtherInput] = useState(false);
            const [customProductName, setCustomProductName] = useState('');


            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Validate form
                if (!validateForm()) {
                    alert('âš ï¸ Please fix the errors in the form before submitting.');
                    return;
                }
                
                // Add custom product name if "Other" was selected
                const activityData = { ...localFormData };
                if (customProductName.trim()) {
                    activityData.data = {
                        ...activityData.data,
                        customProduct: customProductName.trim()
                    };
                }
                
                addActivity(activityData);
            };

            // Comprehensive form validation
            const validateForm = () => {
                const errors = {};
                const activityType = ACTIVITY_TYPES[selectedActivityType];
                
                // Validate required fields
                activityType.fields.forEach(field => {
                    if (field.required) {
                        const value = localFormData.data[field.name];
                        if (!value || value === '') {
                            errors[field.name] = `${field.label} is required`;
                        }
                    }
                });
                
                // Validate coverage area
                if (localFormData.data.coverage) {
                    const coverage = parseInt(localFormData.data.coverage);
                    if (coverage < 0) {
                        errors.coverage = 'Coverage cannot be negative';
                    }
                    if (coverage > 100000) {
                        errors.coverage = 'Coverage seems unrealistically large';
                    }
                }
                
                // Validate amount used
                if (localFormData.data.amountUsed) {
                    const amount = parseFloat(localFormData.data.amountUsed);
                    if (amount < 0) {
                        errors.amountUsed = 'Amount cannot be negative';
                    }
                }
                
                // Validate date
                if (localFormData.date) {
                    const selectedDate = new Date(localFormData.date);
                    const today = new Date();
                    today.setHours(23, 59, 59, 999);
                    if (selectedDate > today) {
                        errors.date = 'Date cannot be in the future';
                    }
                    const twoYearsAgo = new Date();
                    twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                    if (selectedDate < twoYearsAgo) {
                        errors.date = 'Date seems too far in the past';
                    }
                }
                
                // Validate custom product name if "Other" selected
                if (showOtherInput && !customProductName.trim()) {
                    errors.customProduct = 'Please specify the product name';
                }
                
                setValidationErrors(errors);
                return Object.keys(errors).length === 0;
            };

            
            const getProductType = (field) => {
                if (field.type === 'product-select-conditional' && field.conditionalField) {
                    const conditionalValue = localFormData.data[field.conditionalField];
                    return field.productMap[conditionalValue] || field.productType;
                }
                return field.productType;
            };

            return (
                <div>
                    <h2 className="text-2xl font-bold mb-6 text-gray-900 flex items-center gap-3">
                        <img src={activityType.icon} alt={activityType.name} className="w-16 h-16 rounded-full object-cover" />
                        {activityType.name}
                    </h2>
                    
                    <form onSubmit={handleSubmit} className="bg-white rounded-lg shadow-lg p-6 max-w-3xl border border-gray-200">
                        <div className="mb-4">
                            <label className="block text-sm font-semibold mb-2 text-gray-700">Date</label>
                            {validationErrors.date && (
                                <div className="mb-2 text-sm text-red-600 flex items-center gap-1">
                                    <span>âš ï¸</span>
                                    <span>{validationErrors.date}</span>
                                </div>
                            )}
                            <input
                                type="date"
                                required
                                max={new Date().toISOString().split('T')[0]}
                                value={localFormData.date}
                                onChange={(e) => {
                                    setLocalFormData({...localFormData, date: e.target.value});
                                    if (validationErrors.date) {
                                        setValidationErrors({...validationErrors, date: null});
                                    }
                                }}
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                            />
                        </div>

                        {activityType.fields.map(field => {
                            const productType = getProductType(field);
                            const products = PRODUCT_DATABASE[productType] || [];
                            const selectedProduct = selectedProducts[field.name];
                            
                            return (
                                <div key={field.name} className="mb-4">
                                    <label className="block text-sm font-semibold mb-2 text-gray-700">
                                        {field.label}
                                        {field.required && <span className="text-red-600 ml-1">*</span>}
                                    </label>
                                    {validationErrors[field.name] && (
                                        <div className="mb-2 text-sm text-red-600 flex items-center gap-1 bg-red-50 px-3 py-2 rounded-lg border border-red-200">
                                            <span>âš ï¸</span>
                                            <span>{validationErrors[field.name]}</span>
                                        </div>
                                    )}
                                    
                                    {field.type === 'treatment-category' ? (
                                        <div className="grid grid-cols-1 xs:grid-cols-2 gap-3 sm:grid-cols-3">
                                            {Object.entries(TREATMENT_CATEGORIES).map(([key, cat]) => (
                                                <button
                                                    key={key}
                                                    type="button"
                                                    onClick={() => {
                                                        setLocalFormData({
                                                            ...localFormData,
                                                            data: {
                                                                ...localFormData.data,
                                                                category: key,
                                                                product: '' // Reset product when category changes
                                                            }
                                                        });
                                                        setSelectedProducts({});
                                                    }}
                                                    className={`p-3 rounded-lg border-2 font-semibold transition text-sm ${
                                                        localFormData.data.category === key
                                                            ? 'bg-[#367C2B] text-white border-[#367C2B]'
                                                            : 'bg-white text-gray-700 border-gray-200 hover:border-[#367C2B]'
                                                    }`}
                                                >
                                                    <div className="text-xl mb-1">{cat.icon}</div>
                                                    <div>{cat.label}</div>
                                                </button>
                                            ))}
                                        </div>
                                    ) : field.type === 'treatment-product' ? (
                                        <div>
                                            {localFormData.data.category ? (
                                                <>
                                                    <select
                                                        value={localFormData.data[field.name] || ''}
                                                        onChange={(e) => {
                                                            const productId = e.target.value;
                                                            const categoryProducts = TREATMENT_PRODUCTS[localFormData.data.category] || [];
                                                            const product = categoryProducts.find(p => p.id === productId);
                                                            setSelectedProducts({...selectedProducts, [field.name]: product});
                                                            setLocalFormData({
                                                                ...localFormData,
                                                                data: {
                                                                    ...localFormData.data, 
                                                                    [field.name]: product ? product.name : '',
                                                                    productId: productId,
                                                                    activeIngredient: product?.activeIngredient || '',
                                                                    rate: product?.rate || ''
                                                                }
                                                            });
                                                        }}
                                                        required={field.required}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                                    >
                                                        <option value="">{field.placeholder || 'Select product...'}</option>
                                                        {(TREATMENT_PRODUCTS[localFormData.data.category] || []).map(product => (
                                                            <option key={product.id} value={product.id}>
                                                                {product.name}
                                                            </option>
                                                        ))}
                                                    </select>
                                                    
                                                    {/* Custom product name input for "Other" */}
                                                    {localFormData.data.productId && localFormData.data.productId.includes('other') && (
                                                        <div className="mt-3">
                                                            <label className="block text-sm font-semibold mb-2 text-gray-700">
                                                                Specify Product Name <span className="text-red-600">*</span>
                                                            </label>
                                                            {validationErrors.customProduct && (
                                                                <div className="mb-2 text-sm text-red-600 flex items-center gap-1">
                                                                    <span>âš ï¸</span>
                                                                    <span>{validationErrors.customProduct}</span>
                                                                </div>
                                                            )}
                                                            <input
                                                                type="text"
                                                                value={customProductName}
                                                                onChange={(e) => {
                                                                    setCustomProductName(e.target.value);
                                                                    if (validationErrors.customProduct) {
                                                                        setValidationErrors({...validationErrors, customProduct: null});
                                                                    }
                                                                }}
                                                                placeholder="Enter product name (e.g., Generic Prodiamine)"
                                                                className="w-full px-4 py-2 border-2 border-[#367C2B]/30 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                                            />
                                                            <div className="text-xs text-gray-500 mt-1">
                                                                ðŸ’¡ Enter the brand and product name you're using
                                                            </div>
                                                        </div>
                                                    )}
                                                    
                                                    {selectedProducts[field.name] && (
                                                        <div className="mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                                            <div className="text-sm font-semibold text-gray-900 mb-2">
                                                                {selectedProducts[field.name].name}
                                                            </div>
                                                            <div className="space-y-1 text-xs text-gray-600">
                                                                {selectedProducts[field.name].brand && (
                                                                    <div><span className="font-medium">Brand:</span> {selectedProducts[field.name].brand}</div>
                                                                )}
                                                                {selectedProducts[field.name].activeIngredient && (
                                                                    <div><span className="font-medium">Active Ingredient:</span> {selectedProducts[field.name].activeIngredient}</div>
                                                                )}
                                                                {selectedProducts[field.name].rate && (
                                                                    <div><span className="font-medium">Typical Rate:</span> {selectedProducts[field.name].rate}</div>
                                                                )}
                                                                {selectedProducts[field.name].target && (
                                                                    <div><span className="font-medium">Target:</span> {selectedProducts[field.name].target}</div>
                                                                )}
                                                                {selectedProducts[field.name].timing && (
                                                                    <div><span className="font-medium">Timing:</span> {selectedProducts[field.name].timing}</div>
                                                                )}
                                                                {selectedProducts[field.name].type && (
                                                                    <div><span className="font-medium">Type:</span> {selectedProducts[field.name].type}</div>
                                                                )}
                                                                {selectedProducts[field.name].effect && (
                                                                    <div><span className="font-medium">Effect:</span> {selectedProducts[field.name].effect}</div>
                                                                )}
                                                                {selectedProducts[field.name].notes && (
                                                                    <div className="text-gray-500 mt-1"><span className="font-medium">Note:</span> {selectedProducts[field.name].notes}</div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    )}
                                                </>
                                            ) : (
                                                <div className="p-4 bg-yellow-50 border border-yellow-200 rounded-lg text-sm text-yellow-800">
                                                    âš ï¸ Please select a treatment category first
                                                </div>
                                            )}
                                        </div>
                                    ) : field.type === 'product-select' || field.type === 'product-select-conditional' ? (
                                        <div>
                                            {/* My Garage Quick Select */}
                                            {equipment.length > 0 && (
                                                <div className="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                                    <div className="text-xs font-semibold text-blue-700 mb-2">ðŸ  From My Garage:</div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {equipment
                                                            .filter(e => {
                                                                if (productType === 'mowers') return e.type === 'mowers';
                                                                if (productType === 'spreaders') return e.type === 'spreaders';
                                                                return false;
                                                            })
                                                            .map(item => (
                                                                <button
                                                                    key={item.id}
                                                                    type="button"
                                                                    onClick={() => {
                                                                        setLocalFormData({
                                                                            ...localFormData,
                                                                            data: {...localFormData.data, [field.name]: item.name},
                                                                            equipmentUsed: item.id
                                                                        });
                                                                        setSelectedProducts({...selectedProducts, [field.name]: item.product || { name: item.name }});
                                                                        setSelectedEquipmentId(item.id);
                                                                    }}
                                                                    className={`px-2 py-1 border rounded text-xs font-medium ${
                                                                        selectedEquipmentId === item.id
                                                                            ? 'bg-blue-600 text-white border-blue-600'
                                                                            : 'bg-white text-blue-700 border-blue-300 hover:bg-blue-50'
                                                                    }`}
                                                                >
                                                                    {item.name}
                                                                </button>
                                                            ))
                                                        }
                                                    </div>
                                                    
                                                    {/* Hours Input when equipment selected */}
                                                    {selectedEquipmentId && (
                                                        <div className="mt-3 pt-3 border-t border-blue-200">
                                                            <label className="block text-xs font-semibold text-blue-700 mb-1">
                                                                Hours Used
                                                            </label>
                                                            <input
                                                                type="number"
                                                                step="0.1"
                                                                min="0"
                                                                placeholder="0.5"
                                                                value={localFormData.hoursLogged || ''}
                                                                onChange={(e) => setLocalFormData({
                                                                    ...localFormData,
                                                                    hoursLogged: e.target.value
                                                                })}
                                                                className="w-full px-3 py-2 border border-blue-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                            />
                                                            <p className="text-xs text-blue-600 mt-1">
                                                                Will be added to equipment hour meter
                                                            </p>
                                                        </div>
                                                    )}
                                                </div>
                                            )}

                                            <select
                                                value={localFormData.data[field.name] || ''}
                                                onChange={(e) => {
                                                    const productId = e.target.value;
                                                    const product = products.find(p => p.id === productId);
                                                    setSelectedProducts({...selectedProducts, [field.name]: product});
                                                    setLocalFormData({
                                                        ...localFormData,
                                                        data: {...localFormData.data, [field.name]: product ? product.name : ''}
                                                    });
                                                }}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                            >
                                                <option value="">{field.placeholder || 'Select...'}</option>
                                                {products.map(product => (
                                                    <option key={product.id} value={product.id}>
                                                        {product.brand} - {product.name}
                                                    </option>
                                                ))}
                                            </select>
                                            
                                            {/* Custom product name for "Other" equipment */}
                                            {selectedProduct && selectedProduct.id && (selectedProduct.id.includes('other') || selectedProduct.id === 'm-other' || selectedProduct.id === 't-other') && (
                                                <div className="mt-3">
                                                    <label className="block text-sm font-semibold mb-2 text-gray-700">
                                                        Specify Equipment Name <span className="text-red-600">*</span>
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={customProductName}
                                                        onChange={(e) => setCustomProductName(e.target.value)}
                                                        placeholder="Enter equipment name (e.g., Toro Recycler 22)"
                                                        className="w-full px-4 py-2 border-2 border-[#367C2B]/30 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                                    />
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        ðŸ’¡ Enter the brand and model you're using
                                                    </div>
                                                </div>
                                            )}
                                            
                                            {selectedProduct && (
                                                <div className="mt-3 p-3 bg-gray-50 border border-gray-200 rounded-lg">
                                                    <div className="text-sm font-semibold text-gray-900 mb-2">
                                                        {selectedProduct.brand} {selectedProduct.name}
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                                        {selectedProduct.npk && (
                                                            <div><span className="font-medium">NPK:</span> {selectedProduct.npk}</div>
                                                        )}
                                                        {selectedProduct.coverage && (
                                                            <div><span className="font-medium">Coverage:</span> {selectedProduct.coverage}</div>
                                                        )}
                                                        {selectedProduct.type && (
                                                            <div><span className="font-medium">Type:</span> {selectedProduct.type}</div>
                                                        )}
                                                        {selectedProduct.deck && (
                                                            <div><span className="font-medium">Deck:</span> {selectedProduct.deck}</div>
                                                        )}
                                                        {selectedProduct.capacity && (
                                                            <div><span className="font-medium">Capacity:</span> {selectedProduct.capacity}</div>
                                                        )}
                                                        {selectedProduct.features && (
                                                            <div className="col-span-2"><span className="font-medium">Features:</span> {selectedProduct.features}</div>
                                                        )}
                                                        {selectedProduct.variety && (
                                                            <div><span className="font-medium">Variety:</span> {selectedProduct.variety}</div>
                                                        )}
                                                        {selectedProduct.target && (
                                                            <div className="col-span-2"><span className="font-medium">Target:</span> {selectedProduct.target}</div>
                                                        )}
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ) : field.type === 'select' ? (
                                        <select
                                            value={localFormData.data[field.name] || ''}
                                            onChange={(e) => setLocalFormData({
                                                ...localFormData,
                                                data: {...localFormData.data, [field.name]: e.target.value}
                                            })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                        >
                                            <option value="">Select...</option>
                                            {field.options.map(opt => (
                                                <option key={opt} value={opt}>{opt}</option>
                                            ))}
                                        </select>
                                    ) : (
                                        <input
                                            type={field.type}
                                            placeholder={field.placeholder}
                                            value={localFormData.data[field.name] || ''}
                                            onChange={(e) => setLocalFormData({
                                                ...localFormData,
                                                data: {...localFormData.data, [field.name]: e.target.value}
                                            })}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                                        />
                                    )}
                                </div>
                            );
                        })}

                        <div className="mb-4">
                            <label className="block text-sm font-semibold mb-2 text-gray-700">Notes (Optional)</label>
                            <textarea
                                value={localFormData.notes}
                                onChange={(e) => setLocalFormData({...localFormData, notes: e.target.value})}
                                placeholder="Any additional notes..."
                                rows="3"
                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#367C2B] focus:border-transparent"
                            />
                        </div>

                        <div className="flex gap-4">
                            <button
                                type="submit"
                                className="flex-1 px-6 py-3 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition"
                            >
                                Save Activity
                            </button>
                            <button
                                type="button"
                                onClick={() => {
                                    if (confirm('Discard changes and cancel?')) {
                                        setSelectedActivityType(null);
                                        setView(null);
                                    }
                                }}
                                className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 transition"
                            >
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        
        // ==================== DASHBOARD COMPONENT ====================
        // ==================== V4.1 RECOMMENDATION ENGINE ====================
        
        // Growing Season Calculator
        const getGrowingSeason = (grassType, soilTemp) => {
            const now = new Date();
            const month = now.getMonth(); // 0-11
            
            if (!grassType) return null;
            
            // Calendar-based baseline
            let calendarSeason = false;
            if (grassType === 'cool') {
                // Cool season: April (3) through October (9)
                calendarSeason = month >= 3 && month <= 9;
            } else {
                // Warm season: May (4) through September (8)
                calendarSeason = month >= 4 && month <= 8;
            }
            
            // Soil temperature override
            let soilTempActive = false;
            if (soilTemp) {
                if (grassType === 'cool') {
                    soilTempActive = soilTemp >= 40 && soilTemp <= 80;
                } else {
                    soilTempActive = soilTemp >= 65 && soilTemp <= 90;
                }
            }
            
            // Hybrid: Use calendar OR soil temp
            return calendarSeason || soilTempActive;
        };
        
        // Calculate Recommendations
        const calculateRecommendations = () => {
            const recommendations = [];
            const now = new Date();
            
            // Helper: Get days since last activity
            const getDaysSinceActivity = (type) => {
                const lastActivity = activities
                    .filter(a => a.type === type)
                    .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                
                if (!lastActivity) return 999;
                
                const daysSince = Math.floor((now - new Date(lastActivity.date)) / (1000 * 60 * 60 * 24));
                return daysSince;
            };
            
            const grassType = lawnProfile?.grassType;
            const isGrowingSeason = weather ? getGrowingSeason(grassType, weather.soilTemp) : false;
            
            // MOWING RECOMMENDATIONS (Research-Based Heights)
            const daysSinceLastMow = getDaysSinceActivity('mowing');
            
            if (isGrowingSeason && daysSinceLastMow >= 3) {
                let priority = 'low';
                let title = 'Consider Mowing';
                let reason = `It's been ${daysSinceLastMow} days since your last mowing.`;
                
                if (daysSinceLastMow >= 7) {
                    priority = 'high';
                    title = 'Mow Your Lawn';
                    reason = `It's been ${daysSinceLastMow} days - grass is likely overgrown.`;
                } else if (daysSinceLastMow >= 5) {
                    priority = 'medium';
                    title = 'Time to Mow';
                }
                
                const skipRain = weather && (weather.description?.toLowerCase().includes('rain') || weather.description?.toLowerCase().includes('storm'));
                
                if (!skipRain) {
                    let details = isGrowingSeason ? 'Grass is actively growing.' : 'Grass growth is slowing.';
                    
                    // Add height guidance from research program
                    const zone = lawnProfile?.zone;
                    const specificGrass = lawnProfile?.specificGrass;
                    const program = getProgram(zone, specificGrass);
                    
                    if (program && program.mowing) {
                        const month = now.getMonth();
                        let height = '';
                        
                        if (month >= 2 && month <= 4) {
                            height = program.mowing.spring;
                        } else if (month >= 5 && month <= 8) {
                            height = program.mowing.summer;
                        } else if (month >= 9 && month <= 10) {
                            height = program.mowing.fall || program.mowing.spring;
                        }
                        
                        if (height) {
                            details += ` Recommended height: ${height}.`;
                            if (program.mowing.note) {
                                details += ` ${program.mowing.note}.`;
                            }
                        }
                        
                        if (program.mowing.freq) {
                            details += ` Frequency: ${program.mowing.freq}.`;
                        }
                    }
                    
                    recommendations.push({
                        id: 'rec_mowing',
                        type: 'mowing',
                        priority,
                        icon: 'ðŸŒ±',
                        title,
                        reason,
                        details,
                        timing: daysSinceLastMow >= 7 ? 'Within 48 hours' : 'This weekend',
                        action: 'mowing'
                    });
                }
            }
            
            // FERTILIZER RECOMMENDATIONS (Research-Based)
            const daysSinceLastFertilizer = getDaysSinceActivity('fertilizer');
            const weeksSinceLastFertilizer = Math.floor(daysSinceLastFertilizer / 7);
            
            const zone = lawnProfile?.zone;
            const specificGrass = lawnProfile?.specificGrass;
            const program = getProgram(zone, specificGrass);
            
            if (program && program.fertilizer && weather && weather.soilTemp) {
                const month = now.getMonth(); // 0-11
                const currentMonthSchedule = program.fertilizer.schedule.find(s => s.m === month);
                
                if (currentMonthSchedule && weeksSinceLastFertilizer >= 4) {
                    const lbsN = currentMonthSchedule.n;
                    const priority = currentMonthSchedule.p;
                    
                    let details = `Apply ${lbsN} lbs of nitrogen per 1,000 sq ft.`;
                    if (currentMonthSchedule.note) {
                        details += ` ${currentMonthSchedule.note}.`;
                    }
                    
                    // Calculate actual amount needed based on lawn size
                    if (lawnProfile?.lawnSize) {
                        const sqft = parseInt(lawnProfile.lawnSize);
                        const totalLbsNeeded = (sqft / 1000 * lbsN).toFixed(1);
                        details += ` For your ${formatNumber(sqft)} sq ft lawn, apply ~${totalLbsNeeded} lbs total nitrogen.`;
                    }
                    
                    recommendations.push({
                        id: 'rec_fertilizer',
                        type: 'fertilizer',
                        priority,
                        icon: 'ðŸŒ¾',
                        title: `Apply ${month === 8 || month === 9 ? 'Fall' : month === 3 || month === 4 ? 'Spring' : ''} Fertilizer`,
                        reason: `Research-based timing for Zone ${zone} ${specificGrass ? specificGrass.replace('-', ' ') : 'lawn'}.`,
                        details,
                        timing: priority === 'high' ? 'This month (priority)' : 'When convenient this month',
                        action: 'fertilizer'
                    });
                }
            } else if (weather && weather.soilTemp && grassType) {
                // Fallback to simple logic if no program data
                let shouldRecommend = false;
                let fertReason = '';
                let fertPriority = 'low';
                
                if (grassType === 'cool') {
                    const month = now.getMonth();
                    const isSpring = month >= 3 && month <= 5;
                    const isFall = month >= 8 && month <= 9;
                    
                    if (isSpring && weather.soilTemp >= 50 && weather.soilTemp <= 70) {
                        shouldRecommend = weeksSinceLastFertilizer >= 6;
                        fertReason = `Soil temp is ${weather.soilTemp}Â°F - ideal spring feeding window.`;
                        fertPriority = weeksSinceLastFertilizer >= 12 ? 'high' : 'medium';
                    } else if (isFall && weather.soilTemp >= 50) {
                        shouldRecommend = weeksSinceLastFertilizer >= 6;
                        fertReason = `Soil temp is ${weather.soilTemp}Â°F - fall feeding strengthens roots.`;
                        fertPriority = weeksSinceLastFertilizer >= 12 ? 'high' : 'medium';
                    }
                } else if (grassType === 'warm') {
                    const month = now.getMonth();
                    const isSummer = month >= 4 && month <= 7;
                    
                    if (isSummer && weather.soilTemp >= 65) {
                        shouldRecommend = weeksSinceLastFertilizer >= 6;
                        fertReason = `Soil temp is ${weather.soilTemp}Â°F - warm-season grass is actively growing.`;
                        fertPriority = weeksSinceLastFertilizer >= 12 ? 'high' : 'medium';
                    }
                }
                
                if (shouldRecommend) {
                    let details = fertReason;
                    if (lawnProfile?.lawnSize) {
                        const sqft = parseInt(lawnProfile.lawnSize);
                        const lbsNeeded = (sqft / 1000).toFixed(1);
                        details += ` For ${sqft.toLocaleString()} sq ft, apply ~${lbsNeeded} lbs of nitrogen.`;
                    }
                    
                    recommendations.push({
                        id: 'rec_fertilizer',
                        type: 'fertilizer',
                        priority: fertPriority,
                        icon: 'ðŸŒ¾',
                        title: 'Apply Fertilizer',
                        reason: weeksSinceLastFertilizer >= 12 ? `It's been ${weeksSinceLastFertilizer} weeks since last application.` : 'Optimal feeding window is open.',
                        details,
                        timing: 'Within 2 weeks',
                        action: 'fertilizer'
                    });
                }
            }
            
            // WATERING RECOMMENDATIONS
            const daysSinceLastWatering = getDaysSinceActivity('watering');
            
            if (weather && isGrowingSeason) {
                const weeklyRainfall = weather.rainfall || 0;
                const temp = weather.temperature || 0;
                const humidity = weather.humidity || 50;
                
                let shouldRecommend = false;
                let waterPriority = 'low';
                let waterReason = '';
                
                if (weeklyRainfall < 0.5 && temp >= 85 && humidity < 50) {
                    shouldRecommend = true;
                    waterPriority = 'high';
                    waterReason = `Only ${weeklyRainfall}" rain this week. High temps (${temp}Â°F) and low humidity (${humidity}%) stress grass.`;
                } else if (weeklyRainfall < 1.0 && temp >= 75) {
                    shouldRecommend = daysSinceLastWatering >= 3;
                    waterPriority = 'medium';
                    waterReason = `Only ${weeklyRainfall}" rain this week with ${temp}Â°F temps.`;
                }
                
                if (shouldRecommend) {
                    const amountNeeded = (1.0 - weeklyRainfall).toFixed(1);
                    recommendations.push({
                        id: 'rec_watering',
                        type: 'watering',
                        priority: waterPriority,
                        icon: 'ðŸ’§',
                        title: waterPriority === 'high' ? 'Water Your Lawn' : 'Consider Watering',
                        reason: waterReason,
                        details: `Apply ${amountNeeded}" of water. Water deeply and infrequently - early morning is best.`,
                        timing: waterPriority === 'high' ? 'Within 24 hours' : 'This week',
                        action: 'watering'
                    });
                }
            }
            
            // PRE-EMERGENT RECOMMENDATIONS
            const getLastTreatment = (category) => {
                const treatments = activities.filter(a => 
                    a.type === 'fertilizer' && a.data?.category === category
                ).sort((a, b) => new Date(b.date) - new Date(a.date));
                return treatments[0];
            };
            
            const lastPreemergent = getLastTreatment('preemergent');
            const weeksSincePreemergent = lastPreemergent 
                ? Math.floor((now - new Date(lastPreemergent.date)) / (1000 * 60 * 60 * 24 * 7))
                : 999;
            
            if (weather && weather.soilTemp && grassType) {
                let shouldRecommend = false;
                let preReason = '';
                let prePriority = 'medium';
                
                // Pre-emergent window: soil temp 50-55Â°F (crabgrass germinates at 55Â°F)
                if (weather.soilTemp >= 50 && weather.soilTemp <= 58) {
                    shouldRecommend = weeksSincePreemergent >= 10 || weeksSincePreemergent === 999;
                    preReason = `Soil temp is ${weather.soilTemp}Â°F - crabgrass prevention window is open.`;
                    prePriority = weather.soilTemp >= 55 ? 'high' : 'medium'; // Urgent if close to germination
                }
                
                if (shouldRecommend) {
                    let details = preReason + ' Apply before crabgrass seeds germinate (typically at 55Â°F for 3-5 days).';
                    if (lawnProfile?.lawnSize) {
                        const sqft = parseInt(lawnProfile.lawnSize);
                        details += ` For ${sqft.toLocaleString()} sq ft, check product label for exact rate.`;
                    }
                    
                    recommendations.push({
                        id: 'rec_preemergent',
                        type: 'fertilizer',
                        category: 'preemergent',
                        priority: prePriority,
                        icon: 'ðŸ›¡ï¸',
                        title: 'Apply Pre-Emergent',
                        reason: weeksSincePreemergent === 999 
                            ? 'No pre-emergent applied this year' 
                            : `Last application was ${weeksSincePreemergent} weeks ago`,
                        details,
                        timing: prePriority === 'high' ? 'Within 1 week' : 'Within 2 weeks',
                        action: 'fertilizer'
                    });
                }
            }
            
            // OVERSEEDING RECOMMENDATIONS (Cool-Season Only)
            const daysSinceLastSeeding = getDaysSinceActivity('seeding');
            const weeksSinceLastSeeding = Math.floor(daysSinceLastSeeding / 7);
            
            const zone = lawnProfile?.zone;
            const specificGrass = lawnProfile?.specificGrass;
            const program = getProgram(zone, specificGrass);
            
            if (program && program.overseeding && grassType === 'cool') {
                const month = now.getMonth(); // 0-11
                const isSeptember = month === 8; // September is month 8
                const isEarlyOctober = month === 9 && now.getDate() <= 15;
                
                if ((isSeptember || isEarlyOctober) && weeksSinceLastSeeding >= 50) { // Haven't seeded in ~1 year
                    let details = `${program.overseeding.window}: Apply ${program.overseeding.rate} per 1,000 sq ft.`;
                    
                    if (program.overseeding.note) {
                        details += ` ${program.overseeding.note}.`;
                    }
                    
                    if (lawnProfile?.lawnSize) {
                        const sqft = parseInt(lawnProfile.lawnSize);
                        const totalLbs = (sqft / 1000 * parseFloat(program.overseeding.rate)).toFixed(1);
                        details += ` For your ${formatNumber(sqft)} sq ft lawn, you'll need ~${totalLbs} lbs of seed.`;
                    }
                    
                    recommendations.push({
                        id: 'rec_overseeding',
                        type: 'seeding',
                        priority: isSeptember ? 'high' : 'medium',
                        icon: 'ðŸŒ±',
                        title: 'Fall Overseeding Window',
                        reason: `Prime overseeding window for Zone ${zone} ${specificGrass ? specificGrass.replace('-', ' ') : 'lawn'}.`,
                        details: details + ' Pair with core aeration for best results.',
                        timing: isSeptember ? 'This month (optimal)' : 'Before mid-October',
                        action: 'seeding'
                    });
                }
            }
            
            // FUNGICIDE RECOMMENDATIONS
            const lastFungicide = getLastTreatment('fungicide');
            const weeksSinceFungicide = lastFungicide 
                ? Math.floor((now - new Date(lastFungicide.date)) / (1000 * 60 * 60 * 24 * 7))
                : 999;
            
            if (weather && isGrowingSeason) {
                const humidity = weather.humidity || 50;
                const temp = weather.temperature || 0;
                
                let shouldRecommend = false;
                let fungPriority = 'low';
                let fungReason = '';
                
                // High disease pressure: High humidity + warm temps
                if (humidity >= 75 && temp >= 75 && temp <= 90) {
                    // Only recommend if haven't applied recently (4+ weeks)
                    shouldRecommend = weeksSinceFungicide >= 4 || weeksSinceFungicide === 999;
                    fungPriority = humidity >= 85 ? 'medium' : 'low';
                    fungReason = `High humidity (${humidity}%) and warm temps (${temp}Â°F) create ideal conditions for lawn diseases.`;
                }
                
                if (shouldRecommend) {
                    recommendations.push({
                        id: 'rec_fungicide',
                        type: 'fertilizer',
                        category: 'fungicide',
                        priority: fungPriority,
                        icon: 'ðŸ„',
                        title: 'Consider Fungicide',
                        reason: fungReason,
                        details: 'Preventative application recommended. Watch for brown patch, dollar spot, or other disease symptoms.',
                        timing: 'Preventative or at first signs',
                        action: 'fertilizer'
                    });
                }
            }
            
            // MAINTENANCE RECOMMENDATIONS (Mowers Only)
            equipment.filter(eq => eq.type === 'mowers').forEach(mower => {
                const currentHours = mower.currentHours || 0;
                const lastMaint = mower.lastMaintenance;
                const hoursAtLastMaint = lastMaint?.hoursAtMaintenance || 0;
                const hoursSinceMaint = currentHours - hoursAtLastMaint;
                
                // Oil Change Recommendation (every 50 hours)
                if (hoursSinceMaint >= 50) {
                    const priority = hoursSinceMaint >= 75 ? 'high' : hoursSinceMaint >= 60 ? 'medium' : 'low';
                    recommendations.push({
                        id: `rec_oil_${mower.id}`,
                        type: 'maintenance',
                        priority,
                        icon: 'ðŸ”§',
                        title: `Oil Change - ${mower.name}`,
                        reason: `${hoursSinceMaint.toFixed(1)} hours since last ${lastMaint ? 'oil change' : 'purchase'}`,
                        details: hoursSinceMaint >= 75 
                            ? 'Overdue - oil change needed immediately to prevent engine damage.'
                            : `Recommended every 50 hours. Current: ${currentHours.toFixed(1)} hrs.`,
                        timing: hoursSinceMaint >= 75 ? 'Immediately' : 'Within 1 week',
                        action: 'maintenance',
                        equipmentId: mower.id
                    });
                } else if (hoursSinceMaint >= 40 && hoursSinceMaint < 50) {
                    // Gentle reminder at 40 hours
                    recommendations.push({
                        id: `rec_oil_soon_${mower.id}`,
                        type: 'maintenance',
                        priority: 'low',
                        icon: 'ðŸ”§',
                        title: `Oil Change Soon - ${mower.name}`,
                        reason: `${hoursSinceMaint.toFixed(1)} hours since last oil change`,
                        details: `Oil change due at 50 hours. Plan ahead to avoid missed maintenance.`,
                        timing: 'Next 10 hours',
                        action: 'maintenance',
                        equipmentId: mower.id
                    });
                }
                
                // Blade Sharpening Recommendation (every 25 hours)
                if (lastMaint?.type !== 'Blade Sharpening' && hoursSinceMaint >= 25) {
                    const daysSince = lastMaint ? Math.floor((now - new Date(lastMaint.date)) / (1000 * 60 * 60 * 24)) : 180;
                    if (daysSince >= 90) {  // Also check if it's been 3+ months
                        recommendations.push({
                            id: `rec_blades_${mower.id}`,
                            type: 'maintenance',
                            priority: daysSince >= 180 ? 'medium' : 'low',
                            icon: 'ðŸ”ª',
                            title: `Sharpen Blades - ${mower.name}`,
                            reason: `${Math.floor(daysSince / 30)} months since last blade service`,
                            details: 'Dull blades tear grass instead of cutting cleanly, causing brown tips and stress.',
                            timing: daysSince >= 180 ? 'This month' : 'This season',
                            action: 'maintenance',
                            equipmentId: mower.id
                        });
                    }
                }
            });
            
            // Sort by priority
            const priorityOrder = { high: 0, medium: 1, low: 2 };
            recommendations.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
            
            return recommendations.slice(0, 3);
        };

        const Dashboard = () => {
            // Calculate stats based on current view (year/season/all)
            const getFilteredActivities = () => {
                const now = new Date();
                if (statsView === 'year') {
                    return activities.filter(a => new Date(a.date).getFullYear() === now.getFullYear());
                } else if (statsView === 'season') {
                    const year = now.getFullYear();
                    const seasonStart = new Date(year, 3, 1); // April 1
                    const seasonEnd = new Date(year, 9, 31); // October 31
                    return activities.filter(a => {
                        const date = new Date(a.date);
                        return date >= seasonStart && date <= seasonEnd;
                    });
                }
                return activities; // all
            };
        
            const filtered = getFilteredActivities();
            
            // Calculate stats
            const stats = {
                total: filtered.length,
                mowing: filtered.filter(a => a.type === 'mowing').length,
                fertilizer: filtered.filter(a => a.type === 'fertilizer').length,
                watering: filtered.filter(a => a.type === 'watering').length,
                seeding: filtered.filter(a => a.type === 'seeding').length,
                treatment: filtered.filter(a => a.type === 'treatment').length,
                general: filtered.filter(a => a.type === 'general').length,
                totalHours: filtered.reduce((sum, a) => sum + (parseFloat(a.data?.duration) || 0), 0) / 60
            };
        
            // Get monthly data for chart (last 6 months)
            const monthlyData = [];
            const now = new Date();
            for (let i = 5; i >= 0; i--) {
                const month = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthActivities = filtered.filter(a => {
                    const d = new Date(a.date);
                    return d.getMonth() === month.getMonth() && d.getFullYear() === month.getFullYear();
                });
                monthlyData.push({
                    month: month.toLocaleDateString('en', { month: 'short' }),
                    count: monthActivities.length
                });
            }
        
            // Recent activities (last 3)
            const recent = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 3);
        
            return (
                <div className="pb-20">
                    {/* Header */}
                    <div className="mb-4">
                        <button 
                            onClick={() => setView(null)}
                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2 mb-4"
                        >
                            â† Back to Home
                        </button>
                        <h2 className="text-2xl font-bold text-gray-900 mb-4">ðŸ“Š Dashboard</h2>
                        
                        {/* View Toggle */}
                        <div className="flex gap-2 bg-gray-100 p-1 rounded-lg">
                            {[
                                { key: 'year', label: 'This Year' },
                                { key: 'season', label: 'Season' },
                                { key: 'all', label: 'All Time' }
                            ].map(({ key, label }) => (
                                <button
                                    key={key}
                                    onClick={() => setStatsView(key)}
                                    className={`flex-1 py-2 px-4 rounded-md text-sm font-semibold transition ${
                                        statsView === key
                                            ? 'bg-[#367C2B] text-white shadow'
                                            : 'text-gray-600 hover:text-gray-900'
                                    }`}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>
                    </div>
        
                    {/* Quick Stats Grid */}
                    <div className="grid grid-cols-2 gap-3 mb-6">
                        <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                            <div className="text-3xl font-bold text-[#367C2B]">{stats.total}</div>
                            <div className="text-sm text-gray-600 mt-1">Activities</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                            <div className="text-3xl font-bold text-[#367C2B]">{stats.totalHours.toFixed(1)}</div>
                            <div className="text-sm text-gray-600 mt-1">Hours</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                            <div className="text-3xl font-bold text-[#367C2B]">{stats.mowing}</div>
                            <div className="text-sm text-gray-600 mt-1">Mowings</div>
                        </div>
                        <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                            <div className="text-3xl font-bold text-[#F97316]">{stats.fertilizer}</div>
                            <div className="text-sm text-gray-600 mt-1">Fertilizer Apps</div>
                        </div>
                    </div>
        
                    {/* Activity Breakdown */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-6">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">Activity Breakdown</h3>
                        <div className="space-y-3">
                            {[
                                { type: 'mowing', label: 'Mowing', color: '#367C2B', count: stats.mowing },
                                { type: 'fertilizer', label: 'Fertilizer', color: '#F97316', count: stats.fertilizer },
                                { type: 'watering', label: 'Watering', color: '#3B82F6', count: stats.watering },
                                { type: 'seeding', label: 'Seeding', color: '#92400E', count: stats.seeding },
                                { type: 'treatment', label: 'Treatment', color: '#DC2626', count: stats.treatment },
                                { type: 'general', label: 'General', color: '#6B7280', count: stats.general }
                            ].map(({ type, label, color, count }) => {
                                const maxCount = Math.max(stats.mowing, stats.fertilizer, stats.watering, stats.seeding, stats.treatment, stats.general) || 1;
                                const width = (count / maxCount) * 100;
                                return (
                                    <div key={type} className="flex items-center gap-3">
                                        <div className="w-20 text-sm text-gray-600">{label}</div>
                                        <div className="flex-1 bg-gray-100 rounded-full h-8 relative overflow-hidden">
                                            <div 
                                                className="h-full rounded-full transition-all duration-500"
                                                style={{ width: `${width}%`, backgroundColor: color }}
                                            />
                                            <div className="absolute inset-0 flex items-center justify-end pr-3">
                                                <span className="text-sm font-bold" style={{ color: count > 0 ? 'white' : '#6B7280' }}>
                                                    {count}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
        
                    {/* Monthly Trend */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-6">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">Monthly Trend</h3>
                        <div className="flex items-end justify-between h-40 gap-2">
                            {monthlyData.map((data, i) => {
                                const maxCount = Math.max(...monthlyData.map(d => d.count)) || 1;
                                const height = (data.count / maxCount) * 100;
                                return (
                                    <div key={i} className="flex-1 flex flex-col items-center gap-2">
                                        <div className="w-full flex items-end justify-center" style={{ height: '120px' }}>
                                            <div 
                                                className="w-full bg-[#367C2B] rounded-t-lg transition-all duration-500 flex items-end justify-center pb-1"
                                                style={{ height: `${height}%`, minHeight: data.count > 0 ? '24px' : '0' }}
                                            >
                                                {data.count > 0 && (
                                                    <span className="text-xs font-bold text-white">{data.count}</span>
                                                )}
                                            </div>
                                        </div>
                                        <div className="text-xs text-gray-600 font-medium">{data.month}</div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
        
                    {/* Recent Activity */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">ðŸ•’ Recent Activity</h3>
                        {recent.length > 0 ? (
                            <div className="space-y-3">
                                {recent.map(activity => {
                                    const daysSince = Math.floor((new Date() - new Date(activity.date)) / (1000 * 60 * 60 * 24));
                                    const timeAgo = daysSince === 0 ? 'Today' : daysSince === 1 ? 'Yesterday' : `${daysSince} days ago`;
                                    return (
                                        <div key={activity.id} className="flex items-start gap-3 pb-3 border-b border-gray-100 last:border-0">
                                            <img 
                                                src={ACTIVITY_TYPES[activity.type].icon} 
                                                alt={ACTIVITY_TYPES[activity.type].name}
                                                className="w-12 h-12 rounded-lg object-cover flex-shrink-0 shadow-sm"
                                            />
                                            <div className="flex-1 min-w-0">
                                                <div className="font-semibold text-[#367C2B]">{ACTIVITY_TYPES[activity.type].name}</div>
                                                <div className="text-sm text-gray-600">{timeAgo}</div>
                                                {activity.notes && (
                                                    <div className="text-xs text-gray-500 mt-1 truncate">{activity.notes}</div>
                                                )}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <div className="text-center py-8 text-gray-500">
                                <div className="text-4xl mb-2">ðŸ“‹</div>
                                <div>No activities yet</div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        
        // ==================== LAWN PROFILE COMPONENT ====================
        const LawnProfile = () => {
            const [profileData, setProfileData] = useState(lawnProfile || {
                lawnSize: '',
                location: '',
                zone: '', // NEW: USDA Zone (6, 7, 8)
                grassType: '', // cool or warm
                specificGrass: '', // NEW: Specific grass (tall-fescue, bermuda, kentucky-bluegrass)
                grassVariety: '',
                soilType: '',
                sunExposure: '',
                zones: []
            });
        
            const saveLawnProfile = () => {
                // Auto-set grassType based on specificGrass for backwards compatibility
                if (profileData.specificGrass) {
                    if (profileData.specificGrass === 'bermuda') {
                        profileData.grassType = 'warm';
                    } else {
                        profileData.grassType = 'cool';
                    }
                }
                
                localStorage.setItem('lawnProfile', JSON.stringify(profileData));
                setLawnProfile(profileData);
                alert('âœ… Lawn profile saved!');
                setView(null);
            };
        
            return (
                <div className="pb-20">
                    <div className="mb-4">
                        <button 
                            onClick={() => setView(null)}
                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                        >
                            â† Back to Home
                        </button>
                    </div>
                    
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">ðŸŒ± Lawn Profile</h2>
        
                    {/* Basic Information */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-4">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">ðŸ“ Basic Information</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Total Lawn Size <span className="text-red-600">*</span></label>
                                <input
                                    type="number"
                                    value={profileData.lawnSize}
                                    onChange={(e) => setProfileData({...profileData, lawnSize: e.target.value})}
                                    placeholder="5000"
                                    min="100"
                                    max="100000"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                />
                                <div className="text-xs text-gray-500 mt-1">Square feet (typical range: 1,000-50,000)</div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Location</label>
                                <input
                                    type="text"
                                    value={profileData.location}
                                    onChange={(e) => setProfileData({...profileData, location: e.target.value})}
                                    placeholder="Columbus, OH"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    USDA Hardiness Zone <span className="text-red-600">*</span>
                                </label>
                                <select
                                    value={profileData.zone || ''}
                                    onChange={(e) => setProfileData({...profileData, zone: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                >
                                    <option value="">Select your zone...</option>
                                    <option value="5">Zone 5 (Minneapolis, Boston, Buffalo)</option>
                                    <option value="6">Zone 6 (Chicago, NYC, Kansas City)</option>
                                    <option value="7">Zone 7 (Louisville, Nashville, Charlotte) - Transition</option>
                                    <option value="8">Zone 8 (Atlanta, Dallas, Little Rock)</option>
                                </select>
                                <div className="text-xs text-gray-500 mt-1">
                                    <a href="https://planthardiness.ars.usda.gov/" target="_blank" rel="noopener noreferrer" className="text-[#367C2B] underline">
                                        Look up your zone
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    {/* Grass Type */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-4">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">ðŸŒ¾ Grass Type</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Primary Grass Type <span className="text-red-600">*</span>
                                </label>
                                <select
                                    value={profileData.specificGrass || ''}
                                    onChange={(e) => setProfileData({...profileData, specificGrass: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                >
                                    <option value="">Select your grass...</option>
                                    <optgroup label="Cool Season">
                                        <option value="tall-fescue">Tall Fescue</option>
                                        <option value="kentucky-bluegrass">Kentucky Bluegrass</option>
                                    </optgroup>
                                    <optgroup label="Warm Season">
                                        <option value="bermuda">Bermudagrass</option>
                                    </optgroup>
                                </select>
                                <div className="text-xs text-gray-500 mt-1">
                                    Required for accurate recommendations
                                </div>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Grass Variety Notes (Optional)</label>
                                <input
                                    type="text"
                                    value={profileData.grassVariety}
                                    onChange={(e) => setProfileData({...profileData, grassVariety: e.target.value})}
                                    placeholder="e.g., 'Kentucky 31 Tall Fescue'"
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                />
                            </div>
                        </div>
                    </div>
        
                    {/* Soil & Conditions */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-4">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">ðŸŒ Soil & Conditions</h3>
                        
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Soil Type</label>
                                <select
                                    value={profileData.soilType}
                                    onChange={(e) => setProfileData({...profileData, soilType: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                >
                                    <option value="">Select soil type...</option>
                                    <option value="clay">Clay</option>
                                    <option value="sandy">Sandy</option>
                                    <option value="loamy">Loamy</option>
                                    <option value="silty">Silty</option>
                                </select>
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Sun Exposure</label>
                                <select
                                    value={profileData.sunExposure}
                                    onChange={(e) => setProfileData({...profileData, sunExposure: e.target.value})}
                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[#367C2B] focus:outline-none"
                                >
                                    <option value="">Select sun exposure...</option>
                                    <option value="full">Full Sun (6+ hours)</option>
                                    <option value="partial">Partial Shade (3-6 hours)</option>
                                    <option value="shade">Shade (&lt;3 hours)</option>
                                </select>
                            </div>
                        </div>
                    </div>
        
                    {/* Save Button */}
                    <button
                        onClick={saveLawnProfile}
                        className="w-full py-4 bg-[#367C2B] text-white rounded-xl font-bold text-lg hover:bg-[#2d6323] transition shadow-lg"
                    >
                        ðŸ’¾ Save Profile
                    </button>

                    {/* Help Text */}
                    <div className="mt-4 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                        <p className="text-sm text-blue-900">
                            <strong>â„¹ï¸ Why we need this:</strong> Your zone and grass type determine the specific timing, rates, and methods for your lawn care. Future updates will provide university research-based recommendations tailored to your specific combination.
                        </p>
                    </div>
                </div>
            );
        };
        
        // ==================== SETTINGS COMPONENT ====================
        const Settings = () => {
            const exportData = () => {
                const data = {
                    activities: JSON.parse(localStorage.getItem('lawnCareActivities') || '[]'),
                    equipment: JSON.parse(localStorage.getItem('lawnCareEquipment') || '[]'),
                    profile: JSON.parse(localStorage.getItem('lawnProfile') || 'null')
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `lawn-coach-backup-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
            };
        
            const resetData = () => {
                if (confirm('âš ï¸ This will delete ALL your data. Are you absolutely sure?')) {
                    if (confirm('This cannot be undone! Proceed with deleting all activities, equipment, and profile data?')) {
                        localStorage.removeItem('lawnCareActivities');
                        localStorage.removeItem('lawnCareEquipment');
                        localStorage.removeItem('lawnProfile');
                        alert('âœ… All data has been cleared');
                        window.location.reload();
                    }
                }
            };
        
            return (
                <div className="pb-20">
                    <div className="mb-4">
                        <button 
                            onClick={() => setView(null)}
                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                        >
                            â† Back to Home
                        </button>
                    </div>
                    
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">âš™ï¸ Settings</h2>
        
                    {/* Data Management */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100 mb-4">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">ðŸ’¾ Data Management</h3>
                        
                        <button
                            onClick={exportData}
                            className="w-full py-3 px-4 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition mb-3"
                        >
                            ðŸ“¥ Export Data (JSON)
                        </button>
                        
                        <button
                            onClick={resetData}
                            className="w-full py-3 px-4 bg-red-100 text-red-700 rounded-lg font-semibold hover:bg-red-200 transition"
                        >
                            ðŸ—‘ï¸ Reset All Data
                        </button>
                    </div>
        
                    {/* About */}
                    <div className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                        <h3 className="text-lg font-bold text-gray-900 mb-4">â„¹ï¸ About</h3>
                        <div className="text-sm text-gray-600 space-y-2">
                            <p><strong>Lawn Coach</strong> - DIY Lawn Care Tracking</p>
                            <p>Version 4.2</p>
                            <p className="text-xs text-gray-500 mt-4">All data is stored locally in your browser. No account required.</p>
                        </div>
                    </div>
                </div>
            );
        };
        
        // ==================== RESEARCH SOURCES PAGE ====================
        const ResearchSourcesPage = () => {
            return (
                <div className="pb-20">
                    <div className="mb-4">
                        <button 
                            onClick={() => setView(null)}
                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                        >
                            â† Back to Home
                        </button>
                    </div>
                    
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">ðŸ“š Research Sources</h2>

                    <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-4 mb-6">
                        <p className="text-sm text-blue-900">
                            <strong>Evidence-Based Recommendations:</strong> All lawn care guidance in this app is based on peer-reviewed research from university extension programs. These are the same sources professional turf managers use.
                        </p>
                    </div>

                    <div className="space-y-4">
                        {Object.entries(RESEARCH_SOURCES).map(([key, source]) => (
                            <div key={key} className="bg-white rounded-xl p-4 shadow-md border-2 border-gray-100">
                                <div className="flex items-start justify-between">
                                    <div className="flex-1">
                                        <h3 className="text-lg font-bold text-gray-900 mb-1">{source.name}</h3>
                                        <p className="text-sm text-gray-600 mb-3">
                                            {source.count} {source.count === 1 ? 'publication' : 'publications'} referenced
                                        </p>
                                        <a 
                                            href={source.url} 
                                            target="_blank" 
                                            rel="noopener noreferrer"
                                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold text-sm underline"
                                        >
                                            Visit Extension Website â†’
                                        </a>
                                    </div>
                                    <div className="text-3xl">ðŸŽ“</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="mt-6 p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                        <p className="text-sm text-gray-700">
                            <strong>Total Sources:</strong> 19 university extension publications covering fertilization, mowing, pre-emergent timing, overseeding, and seasonal care for cool-season and warm-season grasses across USDA Zones 5-8.
                        </p>
                    </div>

                    <div className="mt-4 p-4 bg-green-50 rounded-lg border-2 border-green-200">
                        <p className="text-sm text-green-900">
                            <strong>Why University Extensions?</strong> Land-grant university extension programs conduct rigorous field research specific to regional climates and grass types. Unlike generic online advice, extension recommendations are tested, peer-reviewed, and updated based on ongoing research.
                        </p>
                    </div>
                </div>
            );
        };
        
        // ==================== RECOMMENDATIONS PAGE ====================
        const RecommendationsPage = () => {
            const recommendations = calculateRecommendations();
            const hasProfile = lawnProfile && lawnProfile.grassType;
            
            return (
                <div className="pb-20">
                    <div className="mb-4">
                        <button 
                            onClick={() => setView(null)}
                            className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                        >
                            â† Back to Home
                        </button>
                    </div>
                    
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">ðŸ“‹ Your Recommendations</h2>

                    {/* Profile Completion Prompt */}
                    {!hasProfile && (
                        <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 mb-6">
                            <div className="flex items-start gap-3">
                                <div className="text-2xl">âš ï¸</div>
                                <div className="flex-1">
                                    <div className="font-semibold text-yellow-900 mb-1">Complete Your Lawn Profile</div>
                                    <div className="text-sm text-yellow-800 mb-3">
                                        Get personalized recommendations by telling us about your grass type and lawn conditions.
                                    </div>
                                    <button
                                        onClick={() => { setView('profile'); }}
                                        className="px-4 py-2 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition text-sm"
                                    >
                                        Complete Profile
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Recommendations List */}
                    {recommendations.length > 0 ? (
                        <div className="space-y-4">
                            {recommendations.map((rec) => {
                                const priorityColors = {
                                    high: { bg: 'bg-red-50', border: 'border-red-200', badge: 'bg-red-600', text: 'text-red-900' },
                                    medium: { bg: 'bg-yellow-50', border: 'border-yellow-200', badge: 'bg-yellow-600', text: 'text-yellow-900' },
                                    low: { bg: 'bg-green-50', border: 'border-green-200', badge: 'bg-green-600', text: 'text-green-900' }
                                };
                                const colors = priorityColors[rec.priority];
                                const priorityLabels = { high: 'URGENT', medium: 'RECOMMENDED', low: 'OPTIONAL' };
                                
                                return (
                                    <div key={rec.id} className={`${colors.bg} border-2 ${colors.border} rounded-xl p-4`}>
                                        {/* Priority Badge */}
                                        <div className="flex items-center justify-between mb-3">
                                            <div className={`px-3 py-1 ${colors.badge} text-white rounded-full text-xs font-bold`}>
                                                {rec.priority === 'high' && 'ðŸ”´'} {rec.priority === 'medium' && 'ðŸŸ¡'} {rec.priority === 'low' && 'ðŸŸ¢'} {priorityLabels[rec.priority]}
                                            </div>
                                            <div className="text-xs text-gray-600 font-medium">{rec.timing}</div>
                                        </div>
                                        
                                        {/* Title */}
                                        <div className="flex items-center gap-2 mb-2">
                                            <span className="text-2xl">{rec.icon}</span>
                                            <h3 className={`text-xl font-bold ${colors.text} flex-1`}>{rec.title}</h3>
                                            {(lawnProfile?.zone && lawnProfile?.specificGrass) && (
                                                <button
                                                    onClick={() => setView('sources')}
                                                    className="text-blue-600 hover:text-blue-700 text-sm font-semibold flex items-center gap-1"
                                                    title="View research sources"
                                                >
                                                    <span className="text-lg">â„¹ï¸</span>
                                                    <span className="hidden sm:inline">Sources</span>
                                                </button>
                                            )}
                                        </div>
                                        
                                        {/* Reason */}
                                        <p className={`text-sm ${colors.text} font-semibold mb-2`}>{rec.reason}</p>
                                        
                                        {/* Details */}
                                        <p className="text-sm text-gray-700 mb-4">{rec.details}</p>
                                        
                                        {/* Action Button */}
                                        <button
                                            onClick={() => {
                                                setSelectedActivityType(rec.action);
                                                setView('add');
                                            }}
                                            className="w-full py-3 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition flex items-center justify-center gap-2"
                                        >
                                            Log {ACTIVITY_TYPES[rec.action].name} â†’
                                        </button>
                                    </div>
                                );
                            })}
                        </div>
                    ) : (
                        <div className="text-center py-12">
                            <div className="text-6xl mb-4">âœ…</div>
                            <div className="text-xl font-bold text-gray-900 mb-2">All Caught Up!</div>
                            <div className="text-gray-600">No recommendations at this time. Check back soon.</div>
                        </div>
                    )}

                    {/* Research Source Note */}
                    {(lawnProfile?.zone && lawnProfile?.specificGrass) && (
                        <div className="mt-6 p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                            <p className="text-sm text-blue-900">
                                <strong>ðŸ“š Research-Based:</strong> These recommendations are tailored to Zone {lawnProfile.zone} {lawnProfile.specificGrass.replace('-', ' ')} based on university extension research. Click the [â„¹ï¸ Sources] button on any recommendation or visit the <button onClick={() => setView('sources')} className="underline font-semibold">Research Sources</button> page to see our references.
                            </p>
                        </div>
                    )}
                </div>
            );
        };

        const HistoryView = () => {
            const sortedActivities = [...activities].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );

            return (
                <div>
                    <h2 className="text-2xl font-bold mb-6">Activity History</h2>
                    
                    {sortedActivities.length === 0 ? (
                        <div className="bg-white rounded-lg shadow p-8 text-center text-gray-500">
                            No activities logged yet. Start by adding your first activity!
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {sortedActivities.map(activity => {
                                const activityType = ACTIVITY_TYPES[activity.type];
                                return (
                                    <div key={activity.id} className="bg-white rounded-lg shadow-lg p-6">
                                        <div className="flex items-start justify-between">
                                            <div className="flex items-start gap-4 flex-1">
                                                <div className={`${activityType.color} text-white p-2 rounded-lg`}>
                                                    <img src={activityType.icon} alt={activityType.name} className="w-16 h-16 rounded-lg object-cover" />
                                                </div>
                                                <div className="flex-1">
                                                    <h3 className="text-xl font-bold mb-1">{activityType.name}</h3>
                                                    <p className="text-gray-600 mb-3">
                                                        {new Date(activity.date).toLocaleDateString('en-US', { 
                                                            weekday: 'long', 
                                                            year: 'numeric', 
                                                            month: 'long', 
                                                            day: 'numeric' 
                                                        })}
                                                    </p>
                                                    
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2 mb-2">
                                                        {Object.entries(activity.data).map(([key, value]) => {
                                                            const field = activityType.fields.find(f => f.name === key);
                                                            if (!value || !field) return null;
                                                            return (
                                                                <div key={key} className="text-sm">
                                                                    <span className="font-semibold">{field.label}:</span>{' '}
                                                                    <span className="text-gray-700">{value}</span>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                    
                                                    {activity.notes && (
                                                        <div className="mt-2 p-2 bg-gray-50 rounded text-sm">
                                                            <span className="font-semibold">Notes:</span> {activity.notes}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            <button
                                                onClick={() => deleteActivity(activity.id)}
                                                className="text-red-500 hover:text-red-700 px-3 py-1"
                                            >
                                                Delete
                                            </button>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        return (
            <div className="min-h-screen bg-gray-50">
                {/* Top Menu Bar */}
                <header className="bg-white shadow-md sticky top-0 z-50">
                    <div className="max-w-5xl mx-auto px-4 py-3 flex items-center justify-between">
                        <button 
                            onClick={() => {
                                setView(null);
                                setSelectedActivityType(null);
                            }}
                            className="flex items-center hover:opacity-80 transition"
                        >
                            <img src="logo.png" alt="Lawn Coach" className="h-10 sm:h-12 w-auto" />
                        </button>
                        
                        {/* Hamburger Menu Button */}
                        <button 
                            onClick={() => setView(view === 'menu' ? null : 'menu')}
                            className="p-2 rounded-lg hover:bg-gray-100 transition"
                            aria-label="Menu"
                        >
                            <svg className="w-8 h-8 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                            </svg>
                        </button>
                    </div>
                    
                    {/* Dropdown Menu */}
                    {view === 'menu' && (
                        <div className="border-t border-gray-200 bg-white shadow-lg">
                            <div className="max-w-5xl mx-auto px-4 py-2">
                                <button
                                    onClick={() => { setView('dashboard'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸ“Š</span>
                                    <span className="text-lg font-semibold text-gray-700">Dashboard</span>
                                </button>
                                <button
                                    onClick={() => {
                                        setView('add');
                                        setSelectedActivityType(null);
                                    }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">âž•</span>
                                    <span className="text-lg font-semibold text-gray-700">Add Activity</span>
                                </button>
                                <button
                                    onClick={() => { setView('history'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸ“‹</span>
                                    <span className="text-lg font-semibold text-gray-700">History</span>
                                </button>
                                <button
                                    onClick={() => { setView('garage'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸ </span>
                                    <span className="text-lg font-semibold text-gray-700">My Garage</span>
                                </button>
                                <button
                                    onClick={() => { setView('profile'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸŒ±</span>
                                    <span className="text-lg font-semibold text-gray-700">Lawn Profile</span>
                                </button>
                                <button
                                    onClick={() => { setView('recommendations'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸ“‹</span>
                                    <span className="text-lg font-semibold text-gray-700">Recommendations</span>
                                </button>
                                <button
                                    onClick={() => { setView('sources'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">ðŸ“š</span>
                                    <span className="text-lg font-semibold text-gray-700">Research Sources</span>
                                </button>
                                <button
                                    onClick={() => { setView('settings'); }}
                                    className="w-full text-left px-4 py-3 rounded-lg hover:bg-[#367C2B]/10 transition flex items-center gap-3"
                                >
                                    <span className="text-2xl">âš™ï¸</span>
                                    <span className="text-lg font-semibold text-gray-700">Settings</span>
                                </button>
                            </div>
                        </div>
                    )}
                </header>

                {/* Home Page - Only show when no view is selected */}
                {!view && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        {/* Profile Completion Banner */}
                        {(!lawnProfile || !lawnProfile.grassType) && (
                            <div className="bg-yellow-50 border-2 border-yellow-300 rounded-xl p-4 mb-4 shadow-md">
                                <div className="flex items-start gap-3">
                                    <div className="text-2xl">âš ï¸</div>
                                    <div className="flex-1">
                                        <div className="font-bold text-yellow-900 mb-1">Complete Your Lawn Profile</div>
                                        <div className="text-sm text-yellow-800 mb-3">
                                            Set up your grass type and lawn details to get personalized recommendations based on weather and your location.
                                        </div>
                                        <button
                                            onClick={() => setView('profile')}
                                            className="px-4 py-2 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition text-sm"
                                        >
                                            Complete Profile Now â†’
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        
                        <WeatherSnapshot />
                    </div>
                )}

                {/* Add Activity Page */}
                {view === 'add' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <div className="mb-4">
                            <button 
                                onClick={() => {
                                    setView(null);
                                    setSelectedActivityType(null);
                                }}
                                className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                            >
                                â† Back to Home
                            </button>
                        </div>
                        {!selectedActivityType && <ActivitySelector />}
                        {selectedActivityType && <ActivityForm />}
                    </div>
                )}

                {/* History Page */}
                {view === 'history' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <div className="mb-4">
                            <button 
                                onClick={() => setView(null)}
                                className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                            >
                                â† Back to Home
                            </button>
                        </div>
                        <HistoryView />
                    </div>
                )}

                {/* My Garage Page */}
                {view === 'garage' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <div className="mb-4">
                            <button 
                                onClick={() => setView(null)}
                                className="text-[#367C2B] hover:text-[#2d6323] font-semibold flex items-center gap-2"
                            >
                                â† Back to Home
                            </button>
                        </div>
                        <MyGarage />
                    </div>
                )}

                {/* Dashboard Page */}
                {view === 'dashboard' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <Dashboard />
                    </div>
                )}

                {/* Lawn Profile Page */}
                {view === 'profile' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <LawnProfile />
                    </div>
                )}

                {/* Settings Page */}
                {view === 'settings' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <Settings />
                    </div>
                )}

                {/* Recommendations Page */}
                {view === 'recommendations' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <RecommendationsPage />
                    </div>
                )}

                {/* Research Sources Page */}
                {view === 'sources' && (
                    <div className="max-w-5xl mx-auto p-2 md:p-3">
                        <ResearchSourcesPage />
                    </div>
                )}

                {/* Profile Prompt Modal */}
                {showProfilePrompt && (
                    <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50" onClick={() => setShowProfilePrompt(false)}>
                        <div className="bg-white rounded-2xl p-6 max-w-md shadow-2xl transform transition-all" onClick={(e) => e.stopPropagation()}>
                            <div className="text-5xl mb-4 text-center">ðŸŒ±</div>
                            <h3 className="text-2xl font-bold text-gray-900 mb-3 text-center">Great Start!</h3>
                            <p className="text-gray-600 mb-6 text-center leading-relaxed">
                                You've logged your first activity! Complete your lawn profile to get personalized recommendations based on your grass type and climate.
                            </p>
                            <div className="flex gap-3">
                                <button
                                    onClick={() => {
                                        setShowProfilePrompt(false);
                                        setView('profile');
                                    }}
                                    className="flex-1 py-3 px-4 bg-[#367C2B] text-white rounded-lg font-semibold hover:bg-[#2d6323] transition-all hover:shadow-lg"
                                >
                                    Complete Profile â†’
                                </button>
                                <button
                                    onClick={() => setShowProfilePrompt(false)}
                                    className="px-4 py-3 bg-gray-100 text-gray-600 rounded-lg font-semibold hover:bg-gray-200 transition-all"
                                >
                                    Later
                                </button>
                            </div>
                        </div>
                    </div>
                )}

            </div>
        );
    }

    ReactDOM.render(<LawnCareTracker />, document.getElementById('root'));
</script>
```

</body>
</html>
